{% extends "delivery_app/base.html" %}

{% block title %}
–ö–æ—Ä–∑–∏–Ω–∞
{% endblock %}

{% block content %}
<div class="cart-container">
    <div class="cart-header">
        <h1>üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>
        <p class="cart-subtitle">–î–∞—Ç–∞: {{ current_date }} | –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞: {{ timezone }}</p>
    </div>

    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            <span>
                {% if message.tags == 'success' %}‚úÖ
                {% elif message.tags == 'error' %}‚ùå
                {% elif message.tags == 'warning' %}‚ö†Ô∏è
                {% else %}‚ÑπÔ∏è{% endif %}
            </span>
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="cart-content">
        {% if cart_items %}
        <div class="cart-main">
            <form method="post" action="{% url 'delivery_app:update_cart' %}" class="cart-form">
                {% csrf_token %}
                <div class="card">
                    <div class="card-header">
                        <h2>–¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ</h2>
                    </div>
                    <div class="card-body">
                        <div class="cart-table-container">
                            <table class="cart-table">
                                <thead>
                                    <tr>
                                        <th>–¢–æ–≤–∞—Ä</th>
                                        <th>–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</th>
                                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                        <th>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in cart_items %}
                                    <tr class="cart-item">
                                        <td class="product-info">
                                            <div class="product-name">{{ item.product.name }}</div>
                                            {% if item.product.description %}
                                            <div class="product-description">{{ item.product.description|truncatewords:10 }}</div>
                                            {% endif %}
                                        </td>
                                        <td class="unit-price">{{ item.product.price }} BYN</td>
                                        <td class="quantity-cell">
                                            <div class="quantity-control">
                                                <button type="button" class="btn-quantity btn-decrease" data-id="{{ item.id }}">-</button>
                                                <input type="number" name="quantity_{{ item.id }}" value="{{ item.quantity }}" min="1" class="quantity-input">
                                                <button type="button" class="btn-quantity btn-increase" data-id="{{ item.id }}">+</button>
                                            </div>
                                        </td>
                                        <td class="total-price">{{ item.total_price }} BYN</td>
                                        <td class="actions">
                                            <a href="{% url 'delivery_app:remove_from_cart' item.id %}" class="btn btn-danger btn-sm" onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')">
                                                <span>üóëÔ∏è</span> –£–¥–∞–ª–∏—Ç—å
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <div class="cart-summary">
                            <div class="summary-card">
                                <div class="summary-header">
                                    <h3>–ò—Ç–æ–≥–∏ –∑–∞–∫–∞–∑–∞</h3>
                                </div>
                                <div class="summary-body">
                                    <div class="summary-row">
                                        <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤:</span>
                                        <span>{{ cart_items|length }}</span>
                                    </div>
                                    <div class="summary-row total">
                                        <span><strong>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</strong></span>
                                        <span class="total-cart-price"><strong>{{ total_price }} BYN</strong></span>
                                    </div>
                                </div>
                                <div class="summary-actions">
                                    <button type="submit" class="btn btn-primary btn-large">
                                        <span>üîÑ</span> –û–±–Ω–æ–≤–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
                                    </button>
                                    <a href="{% url 'delivery_app:checkout' %}" class="btn btn-success btn-large">
                                        <span>üöÄ</span> –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        {% else %}
        <div class="empty-cart">
            <div class="card">
                <div class="card-body">
                    <div class="empty-state">
                        <div class="empty-icon">üõí</div>
                        <h3>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑</p>
                        <a href="{% url 'delivery_app:product_list' %}" class="btn btn-primary">
                            <span>üì¶</span> –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="cart-sidebar">
            <div class="card">
                <div class="card-header">
                    <h3>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ {{ current_date|slice:":7" }}</h3>
                </div>
                <div class="card-body">
                    <table class="calendar-table">
                        <thead>
                            <tr>
                                <th>–ü–Ω</th>
                                <th>–í—Ç</th>
                                <th>–°—Ä</th>
                                <th>–ß—Ç</th>
                                <th>–ü—Ç</th>
                                <th>–°–±</th>
                                <th>–í—Å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for week in calendar %}
                            <tr>
                                {% for day in week %}
                                <td{% if day == 0 %} class="empty"{% endif %}>
                                    {{ day|default:"" }}
                                </td>
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>üöö –£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
                </div>
                <div class="card-body">
                    <div class="delivery-info">
                        <div class="info-item">
                            <span class="info-icon">‚è±Ô∏è</span>
                            <div class="info-text">
                                <strong>–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</strong>
                                <p>–í —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤ –ø–æ –≥–æ—Ä–æ–¥—É</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">üí∞</span>
                            <div class="info-text">
                                <strong>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</strong>
                                <p>–ü—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 50 BYN</p>
                            </div>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">üïí</span>
                            <div class="info-text">
                                <strong>–†–∞–±–æ—Ç–∞–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω–æ</strong>
                                <p>—Å 8:00 –¥–æ 22:00</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ—Ä–∑–∏–Ω—ã */
.cart-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.cart-header {
    text-align: center;
    margin-bottom: 30px;
}

.cart-header h1 {
    color: var(--primary-color);
    margin-bottom: 10px;
    font-size: 2.2em;
}

.cart-subtitle {
    color: var(--text-light);
    font-size: 1.1em;
}

.cart-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    align-items: start;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∫–æ—Ä–∑–∏–Ω—ã */
.cart-table-container {
    overflow-x: auto;
    margin-bottom: 30px;
}

.cart-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.cart-table th {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
    color: rgb(102, 131, 189);
    padding: 15px 12px;
    text-align: left;
    font-weight: 600;
    font-size: 0.9em;
}

.cart-table td {
    padding: 15px 12px;
    border-bottom: 1px solid var(--border-color);
    vertical-align: middle;
}

.cart-table tbody tr:hover {
    background-color: rgba(44, 90, 160, 0.03);
}

.cart-table tbody tr:last-child td {
    border-bottom: none;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–≤–∞—Ä–µ */
.product-info {
    max-width: 250px;
}

.product-name {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 5px;
}

.product-description {
    font-size: 0.85em;
    color: var(--text-light);
    line-height: 1.3;
}

.unit-price, .total-price {
    font-weight: 600;
    color: var(--primary-color);
    white-space: nowrap;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º */
.quantity-control {
    display: flex;
    align-items: center;
    gap: 5px;
    max-width: 120px;
}

.btn-quantity {
    width: 35px;
    height: 35px;
    border: 1px solid var(--border-color);
    background: white;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-weight: bold;
    font-size: 1.1em;
    transition: all 0.3s ease;
}

.btn-quantity:hover {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.quantity-input {
    width: 50px;
    height: 35px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    text-align: center;
    font-weight: 600;
}

.quantity-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π */
.actions {
    white-space: nowrap;
}

.btn-sm {
    padding: 6px 12px;
    font-size: 0.85em;
}

.btn-danger {
    background-color: #dc3545;
    color: white;
    border: none;
}

.btn-danger:hover {
    background-color: #c82333;
    transform: translateY(-1px);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã */
.cart-summary {
    margin-top: 30px;
}

.summary-card {
    background: var(--bg-light);
    border-radius: 10px;
    padding: 20px;
    border: 1px solid var(--border-color);
}

.summary-header {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.summary-header h3 {
    color: var(--primary-color);
    margin: 0;
    font-size: 1.3em;
}

.summary-body {
    margin-bottom: 20px;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
}

.summary-row.total {
    border-top: 2px solid var(--border-color);
    margin-top: 10px;
    padding-top: 15px;
    font-size: 1.1em;
}

.total-cart-price {
    color: var(--primary-color);
    font-size: 1.2em;
}

.summary-actions {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.summary-actions .btn {
    flex: 1;
    min-width: 160px;
    justify-content: center;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω—ã */
.empty-cart {
    grid-column: 1 / -1;
    text-align: center;
}

.empty-state {
    padding: 40px 20px;
}

.empty-icon {
    font-size: 4em;
    margin-bottom: 20px;
    opacity: 0.7;
}

.empty-state h3 {
    color: var(--text-light);
    margin-bottom: 10px;
}

.empty-state p {
    color: var(--text-light);
    margin-bottom: 25px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∞–π–¥–±–∞—Ä–∞ */
.cart-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
.calendar-table {
    width: 100%;
    border-collapse: collapse;
    text-align: center;
}

.calendar-table th {
    background-color: var(--bg-light);
    padding: 10px 5px;
    font-weight: 600;
    color: var(--primary-color);
    font-size: 0.8em;
}

.calendar-table td {
    padding: 8px 5px;
    border: 1px solid var(--border-color);
    font-size: 0.8em;
}

.calendar-table td.empty {
    background-color: var(--bg-light);
    color: var(--text-light);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ—Å—Ç–∞–≤–∫–µ */
.delivery-info {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.info-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.info-icon {
    font-size: 1.2em;
    flex-shrink: 0;
}

.info-text strong {
    display: block;
    color: var(--primary-color);
    margin-bottom: 4px;
    font-size: 0.9em;
}

.info-text p {
    margin: 0;
    font-size: 0.8em;
    color: var(--text-light);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
.card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    overflow: hidden;
}

.card-header {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
    color: rgb(147, 183, 254);
    padding: 20px;
}

.card-header h2,
.card-header h3 {
    color: rgb(147, 183, 254);
    margin: 0;
    font-size: 1.2em;
}

.card-body {
    padding: 20px;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
.cart-table tbody tr {
    animation: fadeInUp 0.4s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 992px) {
    .cart-content {
        grid-template-columns: 1fr;
    }
    
    .summary-actions {
        flex-direction: column;
    }
    
    .summary-actions .btn {
        min-width: auto;
    }
}

@media (max-width: 768px) {
    .cart-container {
        padding: 15px;
    }
    
    .cart-header h1 {
        font-size: 1.8em;
    }
    
    .cart-table {
        font-size: 0.9em;
    }
    
    .cart-table th,
    .cart-table td {
        padding: 10px 8px;
    }
    
    .quantity-control {
        max-width: 100px;
    }
    
    .btn-quantity {
        width: 30px;
        height: 30px;
        font-size: 1em;
    }
    
    .quantity-input {
        width: 40px;
        height: 30px;
    }
}

@media (max-width: 480px) {
    .cart-container {
        padding: 10px;
    }
    
    .cart-table {
        font-size: 0.8em;
    }
    
    .cart-table th,
    .cart-table td {
        padding: 8px 6px;
    }
    
    .product-info {
        max-width: 150px;
    }
    
    .actions .btn {
        padding: 4px 8px;
        font-size: 0.8em;
    }
    
    .info-item {
        flex-direction: column;
        text-align: center;
        gap: 8px;
    }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ */
.alert {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid;
}

.alert-error {
    background-color: rgba(220, 53, 69, 0.1);
    border-color: #dc3545;
    color: #721c24;
}

.alert-success {
    background-color: rgba(40, 167, 69, 0.1);
    border-color: var(--secondary-color);
    color: #155724;
}

.alert-warning {
    background-color: rgba(255, 193, 7, 0.1);
    border-color: #ffc107;
    color: #856404;
}

.alert-info {
    background-color: rgba(23, 162, 184, 0.1);
    border-color: #17a2b8;
    color: #0c5460;
}
</style>

<script>
    document.querySelectorAll('.btn-increase').forEach(button => {
        button.addEventListener('click', function() {
            let input = this.parentElement.querySelector('.quantity-input');
            let newValue = parseInt(input.value) + 1;
            input.value = newValue;
            updateTotalPrice(this.closest('tr'), newValue);
        });
    });

    document.querySelectorAll('.btn-decrease').forEach(button => {
        button.addEventListener('click', function() {
            let input = this.parentElement.querySelector('.quantity-input');
            let newValue = parseInt(input.value) - 1;
            if (newValue >= 1) {
                input.value = newValue;
                updateTotalPrice(this.closest('tr'), newValue);
            }
        });
    });

    document.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('change', function() {
            if (this.value < 1) this.value = 1;
            updateTotalPrice(this.closest('tr'), this.value);
        });
    });

    function updateTotalPrice(row, quantity) {
        let price = parseFloat(row.cells[1].textContent);
        let totalCell = row.cells[3];
        totalCell.textContent = (price * quantity).toFixed(2) + ' BYN';

        let totalCartPrice = 0;
        document.querySelectorAll('.cart-table tbody tr').forEach(row => {
            totalCartPrice += parseFloat(row.cells[3].textContent);
        });
        document.querySelector('.total-cart-price').textContent = totalCartPrice.toFixed(2) + ' BYN';
    }
</script>
{% endblock %}