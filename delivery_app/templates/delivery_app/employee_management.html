{% extends "delivery_app/base.html" %}
{% load static %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ - –î–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤{% endblock %}

{% block content %}
<div class="employee-management">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="management-header">
        <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h1>
        <div class="header-info">
            <span>–ê–∫—Ç—É–∞–ª—å–Ω–æ –Ω–∞: {{ current_date }}</span>
        </div>
    </div>

    <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
    <div id="preloader" class="preloader" style="display: none;">
        <div class="preloader-content">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="management-panel">
        <button id="add-employee-btn" class="btn btn-primary">
            <span>+ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</span>
        </button>

        <button id="premiace-btn" class="btn btn-success" disabled>
            <span>üéâ –ü—Ä–µ–º–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö</span>
        </button>

        <button id="load-server-btn" class="btn btn-info" style="display: none;">
            <span>üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞</span>
        </button>

        <div class="filter-section">
            <input type="text" id="filter-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞...">
            <button id="filter-btn" class="btn btn-secondary">–ù–∞–π—Ç–∏</button>
            <button id="reset-filter-btn" class="btn btn-outline">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
    <div id="add-form-container" class="add-form-container" style="display: none;">
        <form id="add-employee-form" class="add-form">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>

            <div class="form-row">
                <div class="form-group">
                    <label for="new-lastname">–§–∞–º–∏–ª–∏—è *</label>
                    <input type="text" id="new-lastname" required>
                </div>

                <div class="form-group">
                    <label for="new-firstname">–ò–º—è *</label>
                    <input type="text" id="new-firstname" required>
                </div>

                <div class="form-group">
                    <label for="new-middlename">–û—Ç—á–µ—Å—Ç–≤–æ</label>
                    <input type="text" id="new-middlename">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="new-position">–î–æ–ª–∂–Ω–æ—Å—Ç—å *</label>
                    <input type="text" id="new-position" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="new-phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                    <input type="text" id="new-phone" required>
                    <div id="phone-validation" class="validation-message"></div>
                </div>

                <div class="form-group">
                    <label for="new-email">Email *</label>
                    <input type="email" id="new-email" required>
                </div>
            </div>

            <div class="form-group">
                <label for="new-photo">URL —Ñ–æ—Ç–æ</label>
                <input type="text" id="new-photo">
                <div id="url-validation" class="validation-message"></div>
            </div>

            <div class="form-actions">
                <button type="button" id="cancel-add-btn" class="btn btn-outline">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" id="submit-add-btn" class="btn btn-primary" disabled>–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É</button>
            </div>
        </form>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
    <div class="table-container">
        <form id="employees-form" method="get">
            <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è -->
            <input type="hidden" name="selected_employees" id="selected-employees-input"
                value="{{ selected_employees|join:',' }}">

            <table id="employees-table" class="employees-table">
                <thead>
                    <tr>
                        <th width="40">
                            <input type="checkbox" id="select-all">
                        </th>
                        <th>–§–ò–û</th>
                        <th>–§–æ—Ç–æ</th>
                        <th>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</th>
                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                        <th>–ü–æ—á—Ç–∞</th>
                    </tr>
                </thead>
                <tbody id="employees-tbody">
                    {% for employee in page_obj %}
                    <tr data-employee-id="{{ employee.id }}">
                        <td>
                            <input type="checkbox" class="employee-checkbox" name="selected_employees"
                                value="{{ employee.id }}" {% if employee.id in selected_employees %}checked{% endif %}>
                        </td>
                        <td>{{ employee.get_full_name }}</td>
                        <td>
                            {% if employee.photo %}
                            <img src="{{ employee.photo.url }}" alt="{{ employee.get_full_name }}"
                                class="employee-photo-table">
                            {% else %}
                            <div class="photo-placeholder">üì∑</div>
                            {% endif %}
                        </td>
                        <td>{{ employee.position }}</td>
                        <td>{{ employee.phone }}</td>
                        <td>{{ employee.email }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                            –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div class="pagination">
                {% if page_obj.has_previous %}
                <button type="submit" name="page" value="{{ page_obj.previous_page_number }}"
                    class="pagination-btn">‚Äπ</button>
                {% else %}
                <button type="button" class="pagination-btn" disabled>‚Äπ</button>
                {% endif %}

                <span class="page-info">
                    –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
                </span>

                {% if page_obj.has_next %}
                <button type="submit" name="page" value="{{ page_obj.next_page_number }}"
                    class="pagination-btn">‚Ä∫</button>
                {% else %}
                <button type="button" class="pagination-btn" disabled>‚Ä∫</button>
                {% endif %}
            </div>
        </form>
    </div>

    <!-- –ë–ª–æ–∫ –¥–µ—Ç–∞–ª–µ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
    <div id="employee-details" class="employee-details" style="display: none;">
        <h3>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
        <div id="details-content"></div>
    </div>

    <!-- –ë–ª–æ–∫ –ø—Ä–µ–º–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="premiace-results" class="premiate-results" style="display: none;">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–º–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
        <div id="premiace-content"></div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ–∫–±–æ–∫—Å–æ–≤ -->
    <div class="checkbox-generator-section">
        <h3>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤</h3>

        <!-- –§–ª–∞–∂–æ–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
        <div class="generator-toggle">
            <label class="toggle-label">
                <input type="checkbox" id="toggle-checkbox-generator">
                <span class="toggle-slider"></span>
                <span class="toggle-text">–ü–æ–∫–∞–∑–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–µ–∫–±–æ–∫—Å–æ–≤</span>
            </label>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —á–µ–∫–±–æ–∫—Å–∞ -->
        <div id="checkbox-generator-form" class="generator-form" style="display: none;">
            <div class="form-row">
                <div class="form-group">
                    <label for="checkbox-name">Name:</label>
                    <input type="text" id="checkbox-name" placeholder="–ò–º—è —á–µ–∫–±–æ–∫—Å–∞">
                </div>
                <div class="form-group">
                    <label for="checkbox-value">Value:</label>
                    <input type="text" id="checkbox-value" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group checkbox-option">
                    <label>
                        <input type="checkbox" id="checkbox-checked">
                        Checked
                    </label>
                </div>
                <div class="form-group checkbox-option">
                    <label>
                        <input type="checkbox" id="checkbox-required">
                        Required
                    </label>
                </div>
                <div class="form-group checkbox-option">
                    <label>
                        <input type="checkbox" id="checkbox-disabled">
                        Disabled
                    </label>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" id="generate-checkbox-btn" class="btn btn-primary">
                    –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫–±–æ–∫—Å
                </button>
                <button type="button" id="clear-checkboxes-btn" class="btn btn-outline">
                    –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                </button>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤ -->
        <div id="generated-checkboxes-container" class="checkboxes-container"></div>
    </div>
</div>
<style>
    .employee-management * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    .employee-management {
        max-width: 1400px;
        margin: 80px auto 40px;
        padding: 0 20px;
        font-family: 'Inter', Arial, sans-serif;
        line-height: 1.5;
    }

    .management-header {
        background: #9dc4ff;
        color: white;
        padding: 25px 30px;
        border-radius: 8px;
        margin-bottom: 30px;
        text-align: center;
    }

    .management-header h1 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .header-info {
        font-size: 14px;
        opacity: 0.9;
    }

    .preloader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .preloader-content {
        text-align: center;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #2c5aa0;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .management-panel {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        align-items: center;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .btn-primary {
        background: #2c5aa0;
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        background: #1e3d6f;
    }

    .btn-success {
        background: #28a745;
        color: white;
    }

    .btn-success:hover:not(:disabled) {
        background: #1e7e34;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-secondary:hover:not(:disabled) {
        background: #545b62;
    }

    .btn-outline {
        background: transparent;
        border: 1px solid #6c757d;
        color: #6c757d;
    }

    .btn-outline:hover:not(:disabled) {
        background: #6c757d;
        color: white;
    }

    .filter-section {
        display: flex;
        gap: 10px;
        margin-left: auto;
    }

    #filter-input {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        min-width: 250px;
    }

    .add-form-container {
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 20px;
    }

    .add-form h3 {
        margin-bottom: 20px;
        color: #2c5aa0;
    }

    .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
    }

    .form-row .form-group {
        flex: 1;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #333;
    }

    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #2c5aa0;
    }

    .form-group input.invalid {
        border-color: #dc3545;
        background-color: #fff5f5;
    }

    .validation-message {
        font-size: 12px;
        margin-top: 5px;
        min-height: 18px;
    }

    .validation-message.error {
        color: #dc3545;
    }

    .validation-message.success {
        color: #28a745;
    }

    .form-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
    }

    .table-container {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 20px;
    }

    .employees-table {
        width: 100%;
        border-collapse: collapse;
    }

    .employees-table th {
        background: #f8f9fa;
        padding: 15px 10px;
        text-align: left;
        font-weight: 600;
        color: #333;
        border-bottom: 1px solid #e0e0e0;
        cursor: pointer;
        user-select: none;
    }

    .employees-table th.sortable:hover {
        background: #e9ecef;
    }

    .employees-table td {
        padding: 12px 10px;
        border-bottom: 1px solid #f0f0f0;
        vertical-align: top;
    }

    .employees-table tbody tr:hover {
        background: #f8f9fa;
    }

    .employees-table tbody tr.selected {
        background: #e3f2fd;
    }

    .employees-table input[type="checkbox"] {
        width: 18px;
        height: 18px;
    }

    .employee-photo-table {
        width: 50px;
        height: 50px;
        border-radius: 4px;
        object-fit: cover;
    }

    .photo-placeholder {
        width: 50px;
        height: 50px;
        background: #f0f0f0;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
    }

    .sort-indicator {
        margin-left: 5px;
        font-size: 12px;
    }

    .sort-indicator.asc::after {
        content: "‚Üë";
    }

    .sort-indicator.desc::after {
        content: "‚Üì";
    }

    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        padding: 20px;
        background: #f8f9fa;
    }

    .pagination-btn {
        padding: 8px 12px;
        border: 1px solid #ddd;
        background: white;
        border-radius: 4px;
        cursor: pointer;
    }

    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .pagination-btn:hover:not(:disabled) {
        background: #e9ecef;
    }

    .page-info {
        font-size: 14px;
        color: #666;
    }

    .employee-details,
    .premiate-results {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 25px;
        margin-top: 20px;
    }

    .employee-details h3,
    .premiate-results h3 {
        margin-bottom: 15px;
        color: #2c5aa0;
    }

    .detail-item {
        margin-bottom: 10px;
        display: flex;
    }

    .detail-label {
        font-weight: 500;
        min-width: 120px;
        color: #666;
    }

    .detail-value {
        flex: 1;
    }

    .premiate-content {
        background: #f8fff9;
        border: 1px solid #28a745;
        border-radius: 6px;
        padding: 15px;
        color: #155724;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —á–µ–∫–±–æ–∫—Å–æ–≤ */
    .checkbox-generator-section {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 25px;
        margin-top: 30px;
    }

    .checkbox-generator-section h3 {
        color: #2c5aa0;
        margin-bottom: 20px;
        text-align: center;
    }

    .generator-toggle {
        margin-bottom: 20px;
        text-align: center;
    }

    .toggle-label {
        display: inline-flex;
        align-items: center;
        cursor: pointer;
        font-weight: 500;
        color: #333;
    }

    .toggle-label input[type="checkbox"] {
        display: none;
    }

    .toggle-slider {
        width: 50px;
        height: 24px;
        background: #ccc;
        border-radius: 24px;
        position: relative;
        margin-right: 10px;
        transition: background 0.3s ease;
    }

    .toggle-slider::before {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: transform 0.3s ease;
    }

    .toggle-label input[type="checkbox"]:checked+.toggle-slider {
        background: #2c5aa0;
    }

    .toggle-label input[type="checkbox"]:checked+.toggle-slider::before {
        transform: translateX(26px);
    }

    .generator-form {
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .checkbox-option {
        margin-bottom: 0;
    }

    .checkbox-option label {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-weight: normal;
    }

    .checkbox-option input[type="checkbox"] {
        width: auto;
        margin-right: 8px;
    }

    .checkboxes-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
        min-height: 100px;
    }

    .generated-checkbox-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 15px;
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        transition: all 0.3s ease;
    }

    .generated-checkbox-item:hover {
        border-color: #2c5aa0;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .checkbox-with-label {
        display: flex;
        align-items: center;
        flex: 1;
    }

    .checkbox-with-label input[type="checkbox"] {
        width: auto;
        margin-right: 10px;
    }

    .checkbox-attributes {
        font-size: 11px;
        color: #666;
        margin-left: 10px;
        opacity: 0.7;
    }

    .delete-checkbox-btn {
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 12px;
        margin-left: 10px;
    }

    .delete-checkbox-btn:hover {
        background: #c82333;
    }

    .empty-checkboxes-message {
        text-align: center;
        color: #666;
        font-style: italic;
        grid-column: 1 / -1;
        padding: 20px;
    }

    .employees-table th {
        position: relative;
    }

    .employees-table th.sorted-asc::after {
        content: " ‚Üë";
        font-size: 12px;
        color: #2c5aa0;
    }

    .employees-table th.sorted-desc::after {
        content: " ‚Üì";
        font-size: 12px;
        color: #2c5aa0;
    }

    .search-results-info {
        text-align: center;
        padding: 15px;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        margin: 10px 0;
        color: #495057;
    }

    .search-results-info button {
        margin-left: 10px;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }

        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    #search-notification {
        animation: slideIn 0.3s ease;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
        .checkboxes-container {
            grid-template-columns: 1fr;
        }

        .generated-checkbox-item {
            flex-direction: column;
            align-items: flex-start;
        }

        .delete-checkbox-btn {
            align-self: flex-end;
            margin-top: 10px;
            margin-left: 0;
        }
    }

    @media (max-width: 768px) {
        .employee-management {
            margin: 70px auto 30px;
            padding: 0 15px;
        }

        .management-header {
            padding: 20px;
        }

        .management-panel {
            flex-direction: column;
            align-items: stretch;
        }

        .filter-section {
            margin-left: 0;
            justify-content: stretch;
        }

        #filter-input {
            min-width: auto;
            flex: 1;
        }

        .form-row {
            flex-direction: column;
            gap: 0;
        }

        .employees-table {
            font-size: 14px;
        }

        .employees-table th,
        .employees-table td {
            padding: 8px 5px;
        }
    }

    @media (max-width: 480px) {
        .employee-management {
            padding: 0 10px;
        }

        .management-header {
            padding: 15px;
        }

        .add-form-container {
            padding: 15px;
        }

        .table-container {
            overflow-x: auto;
        }

        .employees-table {
            min-width: 800px;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // –ö–ª—é—á –¥–ª—è localStorage
        const SELECTED_EMPLOYEES_KEY = 'selectedEmployees';
        const EMPLOYEES_DATA_KEY = 'employeesData';

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞
        const employeesForm = document.getElementById('employees-form');
        const selectedEmployeesInput = document.getElementById('selected-employees-input');
        const selectAllCheckbox = document.getElementById('select-all');
        const premiaceBtn = document.getElementById('premiace-btn');

        function showPreloader() {
            const preloader = document.getElementById('preloader');
            if (preloader) {
                preloader.style.display = 'flex';
            }
        }

        function hidePreloader() {
            const preloader = document.getElementById('preloader');
            if (preloader) {
                preloader.style.display = 'none';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
        function setupServerLoading() {
            const loadServerBtn = document.getElementById('load-server-btn');
            if (loadServerBtn) {
                loadServerBtn.addEventListener('click', function () {
                    showPreloader();

                    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
                    setTimeout(() => {
                        // –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ —Å —Ñ–æ—Ç–æ
                        const serverEmployees = [
                            {
                                id: 'server_1',
                                firstName: '–ê–Ω–Ω–∞',
                                lastName: '–°–µ—Ä–≥–µ–µ–≤–∞',
                                position: '–°—Ç–∞—Ä—à–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫',
                                phone: '+375 (29) 111-22-33',
                                email: 'anna@company.com',
                                photo: 'https://via.placeholder.com/150/0088cc/ffffff?text=AS'
                            },
                            {
                                id: 'server_2',
                                firstName: '–î–º–∏—Ç—Ä–∏–π',
                                lastName: '–í–∞—Å–∏–ª—å–µ–≤',
                                position: 'Team Lead',
                                phone: '8 (029) 222-33-44',
                                email: 'dmitry@company.com',
                                photo: 'https://via.placeholder.com/150/00aa88/ffffff?text=DV'
                            },
                            {
                                id: 'server_3',
                                firstName: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞',
                                lastName: '–ü–µ—Ç—Ä–æ–≤–∞',
                                position: 'UX/UI –¥–∏–∑–∞–π–Ω–µ—Ä',
                                phone: '80293334455',
                                email: 'ekaterina@company.com',
                                photo: 'https://via.placeholder.com/150/aa0088/ffffff?text=EP'
                            }
                        ];

                        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
                        const currentPage = parseInt(new URLSearchParams(window.location.search).get('page') || '1');
                        const totalServerEmployees = serverEmployees.length;

                        // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                        const tbody = document.getElementById('employees-tbody');
                        if (tbody) {
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Django
                            const existingRows = Array.from(tbody.querySelectorAll('tr[data-employee-id]'));

                            // –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
                            tbody.innerHTML = '';

                            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
                            existingRows.forEach(row => {
                                tbody.appendChild(row);
                            });

                            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                            serverEmployees.forEach(employee => {
                                const row = document.createElement('tr');
                                row.setAttribute('data-employee-id', employee.id);

                                row.innerHTML = `
                            <td>
                                <input type="checkbox" class="employee-checkbox" name="selected_employees" value="${employee.id}">
                            </td>
                            <td>${employee.firstName} ${employee.lastName}</td>
                            <td>
                                <img src="${employee.photo}" alt="${employee.firstName} ${employee.lastName}" class="employee-photo-table">
                            </td>
                            <td>${employee.position}</td>
                            <td>${employee.phone}</td>
                            <td>${employee.email}</td>
                        `;

                                tbody.appendChild(row);
                            });

                            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
                            updatePaginationInfo(totalServerEmployees);
                        }

                        hidePreloader();
                        alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É!');

                    }, 1500);
                });
            }
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        function setupFilter() {
            const filterInput = document.getElementById('filter-input');
            const filterBtn = document.getElementById('filter-btn');

            if (filterBtn && filterInput) {
                filterBtn.addEventListener('click', function () {
                    applyFilter();
                });

                // –¢–∞–∫–∂–µ –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter
                filterInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        applyFilter();
                    }
                });
            }
        }

        // –°–µ—Ä–≤–µ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        function setupSearch() {
            const filterInput = document.getElementById('filter-input');
            const filterBtn = document.getElementById('filter-btn');
            const resetFilterBtn = document.getElementById('reset-filter-btn');

            if (filterBtn && filterInput) {
                filterBtn.addEventListener('click', performServerSearch);

                filterInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        performServerSearch();
                    }
                });

                // –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                let searchTimeout;
                filterInput.addEventListener('input', function () {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (filterInput.value.trim().length >= 2 || filterInput.value.trim() === '') {
                            performServerSearch();
                        }
                    }, 500);
                });
            }

            if (resetFilterBtn) {
                resetFilterBtn.addEventListener('click', function () {
                    filterInput.value = '';
                    performServerSearch();
                });
            }
        }

        async function performServerSearch() {
            const query = document.getElementById('filter-input').value.trim();

            showPreloader();

            try {
                const response = await fetch(`/api/search-employees/?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (response.ok) {
                    updateTableWithSearchResults(data);
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:', error);
                showSearchNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–∏—Å–∫–∞', 'error');
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
                document.getElementById('filter-input').value = '';
                performServerSearch();
            } finally {
                hidePreloader();
            }
        }

        function updateTableWithSearchResults(data) {
            const tbody = document.getElementById('employees-tbody');
            const selectedSet = loadSelectedEmployees();
            const employees = data.employees || [];
            const totalCount = data.total_count || 0;
            const query = data.query || '';

            if (employees.length > 0) {
                let html = '';
                employees.forEach(employee => {
                    const isChecked = selectedSet.has(employee.id.toString());
                    html += `
                <tr data-employee-id="${employee.id}">
                    <td>
                        <input type="checkbox" class="employee-checkbox" name="selected_employees" 
                               value="${employee.id}" ${isChecked ? 'checked' : ''}>
                    </td>
                    <td>${employee.fio}</td>
                    <td>
                        ${employee.photo ?
                            `<img src="${employee.photo}" alt="${employee.fio}" class="employee-photo-table">` :
                            `<div class="photo-placeholder">üì∑</div>`
                        }
                    </td>
                    <td>${employee.description}</td>
                    <td>${employee.phone}</td>
                    <td>${employee.email}</td>
                </tr>
            `;
                });
                tbody.innerHTML = html;

                // –û–±–Ω–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
                updatePaginationForSearch(totalCount, query);

                showSearchNotification(`–ù–∞–π–¥–µ–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${totalCount}${query ? ` –ø–æ –∑–∞–ø—Ä–æ—Å—É "${query}"` : ''}`, 'success');
            } else {
                tbody.innerHTML = `
            <tr>
                <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                    ${query ? `–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã` : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'}
                </td>
            </tr>
        `;

                // –°–∫—Ä—ã—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                updatePaginationForSearch(0, query);
                showSearchNotification(query ? `–ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ` : '–ù–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'warning');
            }

            // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ"
            updateSelectAllState();
            updatePremiateButton(selectedSet);
        }

        function updatePaginationForSearch(totalCount, query) {
            const pagination = document.querySelector('.pagination');
            if (pagination) {
                if (query) {
                    // –ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –ø–æ–∏—Å–∫–µ —Å–∫—Ä—ã—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø–∞–≥–∏–Ω–∞—Ü–∏—é
                    pagination.style.display = 'none';

                    // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞
                    let searchInfo = document.getElementById('search-results-info');
                    if (!searchInfo) {
                        searchInfo = document.createElement('div');
                        searchInfo.id = 'search-results-info';
                        searchInfo.className = 'search-results-info';
                        searchInfo.style.cssText = `
                    text-align: center;
                    padding: 15px;
                    background: #f8f9fa;
                    border: 1px solid #e9ecef;
                    border-radius: 4px;
                    margin: 10px 0;
                    color: #495057;
                `;
                        pagination.parentNode.insertBefore(searchInfo, pagination);
                    }
                    searchInfo.innerHTML = `
                <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</strong> 
                –ù–∞–π–¥–µ–Ω–æ ${totalCount} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ –∑–∞–ø—Ä–æ—Å—É "${query}"
                <button id="clear-search-btn" class="btn btn-sm btn-outline-secondary" style="margin-left: 10px;">
                    –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö
                </button>
            `;

                    // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö"
                    document.getElementById('clear-search-btn').addEventListener('click', function () {
                        document.getElementById('filter-input').value = '';
                        performServerSearch();
                    });
                } else {
                    // –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–∏—Å–∫–∞ –ø–æ–∫–∞–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
                    pagination.style.display = '';

                    // –£–±–∏—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞
                    const searchInfo = document.getElementById('search-results-info');
                    if (searchInfo) {
                        searchInfo.remove();
                    }
                }
            }
        }

        function showSearchNotification(message, type = 'info') {
            // –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            let notification = document.getElementById('search-notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'search-notification';
                notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 400px;
            transition: all 0.3s ease;
        `;
                document.body.appendChild(notification);
            }

            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∏–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            const styles = {
                success: { background: '#4CAF50', color: 'white' },
                error: { background: '#f44336', color: 'white' },
                warning: { background: '#ff9800', color: 'white' },
                info: { background: '#2196F3', color: 'white' }
            };

            Object.assign(notification.style, styles[type] || styles.info);
            notification.textContent = message;
            notification.style.display = 'block';

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        function updatePaginationInfo(totalEmployees) {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
            console.log(`–í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${totalEmployees}`);
        }

        // –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ç–∞–±–ª–∏—Ü–µ–π (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –∫–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–∞–º)
        function setupTableInteractions() {
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
            const headers = document.querySelectorAll('#employees-table th');
            headers.forEach((header, index) => {
                if (index > 0) { // –ü—Ä–æ–ø—É—Å–∫ –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏
                    header.style.cursor = 'pointer';
                    header.addEventListener('click', function () {
                        sortTable(index);
                    });
                }
            });

            // –ö–ª–∏–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π
            document.addEventListener('click', function (e) {
                const row = e.target.closest('tr[data-employee-id]');
                if (row && !e.target.matches('.employee-checkbox')) {
                    showEmployeeDetails(row);
                }
            });
        }

        function sortTable(columnIndex) {
            const table = document.getElementById('employees-table');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            const header = table.querySelectorAll('th')[columnIndex];
            const isAscending = !header.classList.contains('sorted-asc');

            // –°–±—Ä–æ—Å–∏—Ç—å –∫–ª–∞—Å—Å—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —É –≤—Å–µ—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
            table.querySelectorAll('th').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });

            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–ª–∞—Å—Å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            if (isAscending) {
                header.classList.add('sorted-asc');
            } else {
                header.classList.add('sorted-desc');
            }

            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.trim();
                const bValue = b.cells[columnIndex].textContent.trim();

                if (isAscending) {
                    return aValue.localeCompare(bValue, 'ru');
                } else {
                    return bValue.localeCompare(aValue, 'ru');
                }
            });

            // –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–∏—Ç—å tbody
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }

        function showEmployeeDetails(row) {
            const employeeId = row.getAttribute('data-employee-id');
            const cells = row.querySelectorAll('td');

            const detailsContent = `
                <div class="employee-detail">
                    <div class="detail-item">
                        <span class="detail-label">–§–ò–û:</span>
                        <span class="detail-value">${cells[1].textContent}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å:</span>
                        <span class="detail-value">${cells[3].textContent}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                        <span class="detail-value">${cells[4].textContent}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Email:</span>
                        <span class="detail-value">${cells[5].textContent}</span>
                    </div>
                </div>
            `;

            const detailsContainer = document.getElementById('employee-details');
            const detailsContentDiv = document.getElementById('details-content');

            if (detailsContainer && detailsContentDiv) {
                detailsContentDiv.innerHTML = detailsContent;
                detailsContainer.style.display = 'block';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ localStorage
        function loadSelectedEmployees() {
            const saved = localStorage.getItem(SELECTED_EMPLOYEES_KEY);
            if (saved) {
                try {
                    const selectedIds = JSON.parse(saved);
                    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏–∑ localStorage:', selectedIds);
                    return new Set(selectedIds);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', e);
                }
            }
            return new Set();
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –∏–∑ localStorage
        function loadEmployeesData() {
            const saved = localStorage.getItem(EMPLOYEES_DATA_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –∏–∑ localStorage:', data);
                    return data;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö:', e);
                }
            }
            return {};
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ localStorage
        function saveSelectedEmployees(selectedSet) {
            const selectedIds = Array.from(selectedSet);
            localStorage.setItem(SELECTED_EMPLOYEES_KEY, JSON.stringify(selectedIds));
            console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –≤ localStorage:', selectedIds);
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –≤ localStorage
        function saveEmployeesData(employeesData) {
            localStorage.setItem(EMPLOYEES_DATA_KEY, JSON.stringify(employeesData));
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updateEmployeesData(employeesData) {
            document.querySelectorAll('tr[data-employee-id]').forEach(row => {
                const employeeId = row.getAttribute('data-employee-id');
                const cells = row.querySelectorAll('td');
                if (cells.length > 1) {
                    const name = cells[1].textContent.trim();
                    employeesData[employeeId] = name;
                }
            });
            saveEmployeesData(employeesData);
            console.log('–û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:', employeesData);
            return employeesData;
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updateCheckboxesState(selectedSet, employeesData) {
            document.querySelectorAll('.employee-checkbox').forEach(checkbox => {
                const employeeId = checkbox.value;
                checkbox.checked = selectedSet.has(employeeId);
            });
            updateSelectAllState();
            updatePremiateButton(selectedSet);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–µ–º–∏—Ä–æ–≤–∞–Ω–∏—è
        function updatePremiateButton(selectedSet) {
            const checkedCount = selectedSet.size;
            if (premiaceBtn) {
                premiaceBtn.disabled = checkedCount === 0;

                if (checkedCount > 0) {
                    premiaceBtn.style.opacity = '1';
                    premiaceBtn.title = `–ü—Ä–µ–º–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö (${checkedCount})`;
                } else {
                    premiaceBtn.style.opacity = '0.6';
                    premiaceBtn.title = '–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –ø—Ä–µ–º–∏—Ä–æ–≤–∞–Ω–∏—è';
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ" –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updateSelectAllState() {
            const checkboxes = document.querySelectorAll('.employee-checkbox');
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;

            if (selectAllCheckbox && checkboxes.length > 0) {
                if (checkedCount === checkboxes.length) {
                    selectAllCheckbox.checked = true;
                    selectAllCheckbox.indeterminate = false;
                } else if (checkedCount > 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = true;
                } else {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                }
            }
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø–æ ID
        function getEmployeeName(employeeId, employeesData) {
            return employeesData[employeeId] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∏–º–µ–Ω–∞ –≤—Å–µ—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        function getSelectedEmployeeNames(selectedSet, employeesData) {
            const names = [];
            selectedSet.forEach(id => {
                names.push(getEmployeeName(id, employeesData));
            });
            return names;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        function setupCheckboxHandlers(selectedSet, employeesData) {
            document.addEventListener('change', function (e) {
                if (e.target.matches('.employee-checkbox')) {
                    const employeeId = e.target.value;

                    if (e.target.checked) {
                        selectedSet.add(employeeId);
                        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ
                        const row = e.target.closest('tr');
                        if (row) {
                            const cells = row.querySelectorAll('td');
                            if (cells.length > 1) {
                                employeesData[employeeId] = cells[1].textContent.trim();
                                saveEmployeesData(employeesData);
                            }
                        }
                    } else {
                        selectedSet.delete(employeeId);
                    }

                    saveSelectedEmployees(selectedSet);
                    updateSelectAllState();
                    updatePremiateButton(selectedSet);
                    console.log('–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', Array.from(selectedSet));
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ" –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function setupSelectAllHandler(selectedSet, employeesData) {
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function () {
                    const checkboxes = document.querySelectorAll('.employee-checkbox');
                    const currentPageIds = Array.from(checkboxes).map(cb => cb.value);

                    checkboxes.forEach(cb => {
                        const employeeId = cb.value;
                        cb.checked = this.checked;

                        if (this.checked) {
                            selectedSet.add(employeeId);
                            // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–µ
                            const row = cb.closest('tr');
                            if (row) {
                                const cells = row.querySelectorAll('td');
                                if (cells.length > 1) {
                                    employeesData[employeeId] = cells[1].textContent.trim();
                                }
                            }
                        } else {
                            // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                            if (currentPageIds.includes(employeeId)) {
                                selectedSet.delete(employeeId);
                            }
                        }
                    });

                    saveSelectedEmployees(selectedSet);
                    saveEmployeesData(employeesData);
                    updatePremiateButton(selectedSet);
                    console.log('–í—ã–±—Ä–∞—Ç—å –≤—Å–µ:', Array.from(selectedSet));
                });
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–µ–º–∏—Ä–æ–≤–∞–Ω–∏—è
        function setupPremiateHandler(selectedSet, employeesData) {
            if (premiaceBtn) {
                premiaceBtn.addEventListener('click', function () {
                    if (selectedSet.size > 0) {
                        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏–∑ –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã
                        const names = [];
                        selectedSet.forEach(employeeId => {
                            // –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ DOM —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                            const row = document.querySelector(`tr[data-employee-id="${employeeId}"]`);
                            if (row) {
                                const cells = row.querySelectorAll('td');
                                if (cells.length > 1) {
                                    names.push(cells[1].textContent.trim());
                                }
                            } else {
                                // –ï—Å–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–µ—Ç –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                                names.push(employeesData[employeeId] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π');
                            }
                        });

                        const premiaceContent = document.getElementById('premiace-content');
                        const premiaceResults = document.getElementById('premiace-results');
                        const employeeDetails = document.getElementById('employee-details');

                        premiaceContent.innerHTML = `
                            <div class="premiate-content">
                                <p>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –ø—Ä–µ–º–∏–∏!</p>
                                <p><strong>–ü—Ä–µ–º–∏—Ä–æ–≤–∞–Ω—ã:</strong> ${names.join(', ')}</p>
                                <p>–ó–∞ –≤—ã—Å–æ–∫–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –≤—ã–¥–∞—é—â–∏–π—Å—è –≤–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏.</p>
                                <p>–ñ–µ–ª–∞–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —É—Å–ø–µ—Ö–æ–≤ –≤ —Ä–∞–±–æ—Ç–µ!</p>
                            </div>
                        `;

                        premiaceResults.style.display = 'block';
                        if (employeeDetails) {
                            employeeDetails.style.display = 'none';
                        }

                        // –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä –ø–æ—Å–ª–µ –ø—Ä–µ–º–∏—Ä–æ–≤–∞–Ω–∏—è
                        selectedSet.clear();
                        document.querySelectorAll('.employee-checkbox').forEach(cb => {
                            cb.checked = false;
                        });
                        if (selectAllCheckbox) {
                            selectAllCheckbox.checked = false;
                            selectAllCheckbox.indeterminate = false;
                        }
                        saveSelectedEmployees(selectedSet);
                        updatePremiateButton(selectedSet);
                        console.log('–°–±—Ä–æ—à–µ–Ω—ã –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–µ–º–∏—Ä–æ–≤–∞–Ω–∏—è');
                    }
                });
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã (–ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏)
        function setupFormHandler(selectedSet) {
            if (employeesForm) {
                employeesForm.addEventListener('submit', function (e) {
                    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã
                    if (selectedEmployeesInput) {
                        selectedEmployeesInput.value = JSON.stringify(Array.from(selectedSet));
                    }
                    saveSelectedEmployees(selectedSet);
                    console.log('–§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏:', Array.from(selectedSet));
                });
            }
        }

        // ========== –§–û–†–ú–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø –°–û–¢–†–£–î–ù–ò–ö–ê ==========
        function setupAddEmployeeForm() {
            const addEmployeeBtn = document.getElementById('add-employee-btn');
            const addFormContainer = document.getElementById('add-form-container');
            const cancelAddBtn = document.getElementById('cancel-add-btn');
            const addForm = document.getElementById('add-employee-form');

            if (addEmployeeBtn && addFormContainer) {
                addEmployeeBtn.addEventListener('click', function () {
                    addFormContainer.style.display = addFormContainer.style.display === 'none' ? 'block' : 'none';
                });
            }

            if (cancelAddBtn && addFormContainer) {
                cancelAddBtn.addEventListener('click', function () {
                    addFormContainer.style.display = 'none';
                    if (addForm) {
                        addForm.reset();
                    }
                    resetValidation();
                });
            }

            // –§—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            const validators = {
                url: function (url) {
                    if (!url) return { isValid: true, message: '' };

                    const pattern = /^(http:\/\/|https:\/\/).*\.(php|html)$/;
                    const isValid = pattern.test(url);

                    return {
                        isValid,
                        message: isValid ? 'URL –≤–∞–ª–∏–¥–µ–Ω' : 'URL –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http:// –∏–ª–∏ https:// –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ .php –∏–ª–∏ .html'
                    };
                },

                phone: function (phone) {
                    if (!phone) return { isValid: false, message: '–¢–µ–ª–µ—Ñ–æ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' };

                    // –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                    const patterns = [
                        /^\+375\s?\(\d{2}\)\s?\d{3}-\d{2}-\d{2}$/, // +375 (29) XXX-XX-XX
                        /^\+375\d{9}$/, // +375XXXXXXXXX
                        /^8\s?\(\d{3}\)\s?\d{3}-\d{2}-\d{2}$/, // 8 (XXX) XXX-XX-XX
                    ];

                    const isValid = patterns.some(pattern => pattern.test(phone));

                    return {
                        isValid,
                        message: isValid ? '–¢–µ–ª–µ—Ñ–æ–Ω –≤–∞–ª–∏–¥–µ–Ω' : '–¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ: +375 (29) XXX-XX-XX'
                    };
                },

                email: function (email) {
                    if (!email) return { isValid: false, message: 'Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' };

                    const pattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    const isValid = pattern.test(email);

                    return {
                        isValid,
                        message: isValid ? 'Email –≤–∞–ª–∏–¥–µ–Ω' : '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å'
                    };
                }
            };

            function validateForm() {
                const url = document.getElementById('new-photo').value;
                const phone = document.getElementById('new-phone').value;
                const firstName = document.getElementById('new-firstname').value;
                const lastName = document.getElementById('new-lastname').value;
                const position = document.getElementById('new-position').value;
                const email = document.getElementById('new-email').value;

                const urlValidation = validators.url(url);
                const phoneValidation = validators.phone(phone);
                const emailValidation = validators.email(email);

                updateValidation('url', urlValidation);
                updateValidation('phone', phoneValidation);
                updateValidation('email', emailValidation);

                const allFieldsFilled = firstName && lastName && position && phone && email;
                const allValid = urlValidation.isValid && phoneValidation.isValid && emailValidation.isValid && allFieldsFilled;

                const submitBtn = document.getElementById('submit-add-btn');
                if (submitBtn) {
                    submitBtn.disabled = !allValid;
                }

                return allValid;
            }

            function updateValidation(field, validation) {
                const input = document.getElementById(`new-${field}`);
                const messageElement = document.getElementById(`${field}-validation`);

                if (input && messageElement) {
                    if (validation.message) {
                        messageElement.textContent = validation.message;
                        messageElement.className = `validation-message ${validation.isValid ? 'success' : 'error'}`;

                        if (validation.isValid) {
                            input.classList.remove('invalid');
                        } else {
                            input.classList.add('invalid');
                        }
                    } else {
                        messageElement.textContent = '';
                        messageElement.className = 'validation-message';
                        input.classList.remove('invalid');
                    }
                }
            }

            function resetValidation() {
                document.querySelectorAll('.validation-message').forEach(el => {
                    el.textContent = '';
                    el.className = 'validation-message';
                });

                document.querySelectorAll('.invalid').forEach(el => {
                    el.classList.remove('invalid');
                });

                const submitBtn = document.getElementById('submit-add-btn');
                if (submitBtn) {
                    submitBtn.disabled = true;
                }
            }

            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            const photoInput = document.getElementById('new-photo');
            if (photoInput) {
                photoInput.addEventListener('input', validateForm);
            }

            const phoneInput = document.getElementById('new-phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', validateForm);
            }

            const emailInput = document.getElementById('new-email');
            if (emailInput) {
                emailInput.addEventListener('input', validateForm);
            }

            // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
            const requiredFields = ['new-firstname', 'new-lastname', 'new-position', 'new-phone', 'new-email'];
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', validateForm);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            if (addForm) {
                addForm.addEventListener('submit', async function (e) {
                    e.preventDefault();

                    if (!validateForm()) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ');
                        return;
                    }

                    showPreloader();

                    try {
                        // –°–æ–±–∏—Ä–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
                        const formData = {
                            first_name: document.getElementById('new-firstname').value.trim(),
                            last_name: document.getElementById('new-lastname').value.trim(),
                            middle_name: document.getElementById('new-middlename').value.trim(),
                            position: document.getElementById('new-position').value.trim(),
                            phone: document.getElementById('new-phone').value.trim(),
                            email: document.getElementById('new-email').value.trim(),
                            photo_url: document.getElementById('new-photo').value.trim()
                        };

                        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                        const response = await fetch('/api/add-employee/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCSRFToken()
                            },
                            body: JSON.stringify(formData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            // –£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ
                            alert('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                            addFormContainer.style.display = 'none';
                            addForm.reset();
                            resetValidation();

                            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                            window.location.reload();
                        } else {
                            // –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                        }
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞:', error);
                        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö');
                    } finally {
                        hidePreloader();
                    }
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
        function getCSRFToken() {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='))
                ?.split('=')[1];
            return cookieValue || '';
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function init() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏');

            // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –¥–∞–Ω–Ω—ã–µ –æ –Ω–∏—Ö
            const selectedSet = loadSelectedEmployees();
            let employeesData = loadEmployeesData();

            // –û–±–Ω–æ–≤ –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            employeesData = updateEmployeesData(employeesData);

            // –û–±–Ω–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–æ–≤
            updateCheckboxesState(selectedSet, employeesData);

            // –ù–∞—Å—Ç—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            setupCheckboxHandlers(selectedSet, employeesData);
            setupSelectAllHandler(selectedSet, employeesData);
            setupPremiateHandler(selectedSet, employeesData);
            setupFormHandler(selectedSet);
            setupAddEmployeeForm();

            setupServerLoading();
            setupSearch();
            setupTableInteractions();

            updatePremiateButton(selectedSet);

            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Ñ–æ—Ä–º—ã, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            if (selectedEmployeesInput) {
                selectedEmployeesInput.value = JSON.stringify(Array.from(selectedSet));
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        init();
    });

    // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–µ–∫–±–æ–∫—Å–æ–≤
    document.addEventListener('DOMContentLoaded', function () {
        const toggleGenerator = document.getElementById('toggle-checkbox-generator');
        const generatorForm = document.getElementById('checkbox-generator-form');
        const generateBtn = document.getElementById('generate-checkbox-btn');
        const clearBtn = document.getElementById('clear-checkboxes-btn');
        const checkboxesContainer = document.getElementById('generated-checkboxes-container');
        const STORAGE_KEY = 'generatedCheckboxes';

        function loadSavedCheckboxes() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const checkboxes = JSON.parse(saved);
                    checkboxes.forEach(checkbox => renderCheckbox(checkbox, false));
                    updateEmptyMessage();
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ–∫–±–æ–∫—Å–æ–≤:', e);
                }
            }
        }

        function saveCheckboxes() {
            const checkboxes = [];
            document.querySelectorAll('.generated-checkbox-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                checkboxes.push({
                    name: checkbox.name,
                    value: checkbox.value,
                    checked: checkbox.checked,
                    required: checkbox.required,
                    disabled: checkbox.disabled,
                    label: item.querySelector('.checkbox-label').textContent
                });
            });
            localStorage.setItem(STORAGE_KEY, JSON.stringify(checkboxes));
        }

        function updateEmptyMessage() {
            const hasCheckboxes = checkboxesContainer.querySelector('.generated-checkbox-item');
            if (!hasCheckboxes) {
                checkboxesContainer.innerHTML = '<div class="empty-checkboxes-message">–ù–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤</div>';
            }
        }

        function renderCheckbox(attributes, save = true) {
            const { name, value, checked, required, disabled, label } = attributes;
            const checkboxId = `checkbox-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

            const checkboxItem = document.createElement('div');
            checkboxItem.className = 'generated-checkbox-item';
            checkboxItem.innerHTML = `
            <div class="checkbox-with-label">
                <input type="checkbox" 
                       id="${checkboxId}"
                       name="${name || ''}"
                       value="${value || ''}"
                       ${checked ? 'checked' : ''}
                       ${required ? 'required' : ''}
                       ${disabled ? 'disabled' : ''}>
                <label for="${checkboxId}" class="checkbox-label">
                    ${label || (name || '–ß–µ–∫–±–æ–∫—Å')}
                </label>
                <span class="checkbox-attributes">
                    ${getAttributesString(attributes)}
                </span>
            </div>
            <button type="button" class="delete-checkbox-btn" title="–£–¥–∞–ª–∏—Ç—å">
                ‚úï
            </button>
        `;

            const deleteBtn = checkboxItem.querySelector('.delete-checkbox-btn');
            deleteBtn.addEventListener('click', function () {
                checkboxItem.remove();
                saveCheckboxes();
                updateEmptyMessage();
            });

            const emptyMessage = checkboxesContainer.querySelector('.empty-checkboxes-message');
            if (emptyMessage) {
                emptyMessage.remove();
            }

            checkboxesContainer.appendChild(checkboxItem);

            if (save) {
                saveCheckboxes();
            }
        }

        function getAttributesString(attributes) {
            const parts = [];
            if (attributes.checked) parts.push('checked');
            if (attributes.required) parts.push('required');
            if (attributes.disabled) parts.push('disabled');
            return parts.length > 0 ? `[${parts.join(', ')}]` : '';
        }

        function generateNewCheckbox() {
            const name = document.getElementById('checkbox-name').value.trim() || `checkbox_${Date.now()}`;
            const value = document.getElementById('checkbox-value').value.trim() || 'on';
            const checked = document.getElementById('checkbox-checked').checked;
            const required = document.getElementById('checkbox-required').checked;
            const disabled = document.getElementById('checkbox-disabled').checked;
            const label = name.charAt(0).toUpperCase() + name.slice(1).replace(/_/g, ' ');

            const attributes = { name, value, checked, required, disabled, label };
            renderCheckbox(attributes);

            document.getElementById('checkbox-name').value = '';
            document.getElementById('checkbox-value').value = '';
            document.getElementById('checkbox-checked').checked = false;
            document.getElementById('checkbox-required').checked = false;
            document.getElementById('checkbox-disabled').checked = false;
        }

        function clearAllCheckboxes() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–µ–∫–±–æ–∫—Å—ã?')) {
                checkboxesContainer.innerHTML = '';
                localStorage.removeItem(STORAGE_KEY);
                updateEmptyMessage();
            }
        }

        function initCheckboxGenerator() {
            if (toggleGenerator) {
                toggleGenerator.addEventListener('change', function () {
                    if (generatorForm) {
                        generatorForm.style.display = this.checked ? 'block' : 'none';
                    }
                });
            }

            if (generateBtn) {
                generateBtn.addEventListener('click', generateNewCheckbox);
            }

            if (clearBtn) {
                clearBtn.addEventListener('click', clearAllCheckboxes);
            }

            loadSavedCheckboxes();
            updateEmptyMessage();
        }

        initCheckboxGenerator();
    });
</script>
{% endblock %}