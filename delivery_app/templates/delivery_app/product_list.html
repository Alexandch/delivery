{% extends "delivery_app/base.html" %}
{% load static %}
{% load url_helpers %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ - –î–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤{% endblock %}

{% block content %}

<div class="floating-cart" id="floatingCart">
    <div class="cart-icon">
        üõí
        <span class="cart-count" id="cartCount">0</span>
    </div>
    <div class="cart-tooltip">–ö–æ—Ä–∑–∏–Ω–∞</div>
</div>

<div class="products-simple">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —á–∞—Å—Ç–∏—Ü -->
    <div class="simple-header" id="animatedHeader">
        <canvas id="particleCanvas"></canvas>
        <div class="header-content">
            <h1 data-scroll="fadeInUp">–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
            <div class="header-info" data-scroll="fadeInUp" data-scroll-delay="200">
                <span>–ê–∫—Ç—É–∞–ª—å–Ω–æ –Ω–∞: {% now "d.m.Y" %}</span>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ -->
    <div class="simple-content">
        <!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="filter-section">
            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            {% if search_query or type_filter %}
            <div style="margin-bottom: 15px; padding: 10px; background: #e8f4fc; border-radius: 6px; border-left: 4px solid #3498db;"
                data-scroll="slideInDown">
                <strong>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:</strong>
                {% if search_query %}<span class="filter-indicator">–ü–æ–∏—Å–∫: "{{ search_query }}"</span>{% endif %}
                {% if type_filter %}<span class="filter-indicator">–¢–∏–ø: {{ type_filter }}</span>{% endif %}
                {% if sort_by != 'name' %}<span class="filter-indicator">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: {{ sort_by }}</span>{% endif %}
            </div>
            {% endif %}

            <form method="get" class="product-filter-form" data-scroll="fadeInUp" data-scroll-delay="400">
                <!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
                <input type="hidden" name="per_page" value="{{ per_page }}">
                <!-- –ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É -->
                <input type="hidden" name="page" value="1">

                <div class="filter-grid">
                    <div class="filter-group">
                        <label for="search">–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤</label>
                        <input type="text" id="search" name="search" value="{{ search_query }}"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...">
                    </div>

                    <div class="filter-group">
                        <label for="type">–¢–∏–ø —Ç–æ–≤–∞—Ä–∞</label>
                        <select id="type" name="type">
                            <option value="">–í—Å–µ —Ç–∏–ø—ã —Ç–æ–≤–∞—Ä–æ–≤</option>
                            {% for type in product_types %}
                            <option value="{{ type.name }}" {% if type_filter == type.name %}selected{% endif %}>
                                {{ type.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
                        <select id="sort" name="sort">
                            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)</option>
                            <option value="-name" {% if sort_by == '-name' %}selected{% endif %}>–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)
                            </option>
                            <option value="price" {% if sort_by == 'price' %}selected{% endif %}>–ü–æ —Ü–µ–Ω–µ (–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ)
                            </option>
                            <option value="-price" {% if sort_by == '-price' %}selected{% endif %}>–ü–æ —Ü–µ–Ω–µ (—É–±—ã–≤–∞–Ω–∏–µ)
                            </option>
                            <option value="stock" {% if sort_by == 'stock' %}selected{% endif %}>–ü–æ –Ω–∞–ª–∏—á–∏—é</option>
                        </select>
                    </div>

                    <div class="filter-actions">
                        <button type="submit" class="filter-btn">
                            <span class="btn-icon">üîç</span>
                            –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                        </button>
                        <a href="{% url 'delivery_app:product_list' %}?per_page={{ per_page }}" class="reset-btn">
                            <span class="btn-icon">üîÑ</span>
                            –°–±—Ä–æ—Å–∏—Ç—å
                        </a>
                    </div>
                </div>
            </form>
        </div>

        <!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div class="products-section">
            {% if products %}
            <div class="products-grid-container">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ—Ç–∫–∏ -->
                <div class="grid-header">
                    <h2 data-scroll="fadeInUp">–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
                    <span class="products-count" data-scroll="fadeInUp" data-scroll-delay="200">
                        {% if products %}
                        –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ paginator.count }}
                        {% else %}
                        –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                        {% endif %}
                    </span>
                </div>

                <!-- CSS Grid Layout –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ -->
                <div class="products-grid">
                    {% for product in products %}
                    <article class="product-card" data-product-id="{{ product.id }}" 
                             data-scroll="fadeInUp" data-scroll-delay="{{ forloop.counter0|add:100 }}">
                        <!-- –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                        <div class="card-header">
                            <div class="product-image-container">
                                {% if product.image %}
                                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image"
                                    loading="lazy">
                                {% else %}
                                <div class="product-image-placeholder">
                                    <span class="placeholder-icon">üõí</span>
                                </div>
                                {% endif %}

                                <!-- –ë–µ–π–¥–∂ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                                <div class="category-badge">
                                    {{ product.product_type.name }}
                                </div>

                                <!-- –°—Ç–∞—Ç—É—Å –Ω–∞–ª–∏—á–∏—è -->
                                <div class="stock-status {% if product.stock > 0 %}in-stock{% else %}out-of-stock{% endif %}">
                                    {% if product.stock > 0 %}
                                    ‚úÖ –í –Ω–∞–ª–∏—á–∏–∏
                                    {% else %}
                                    ‚ùå –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="card-body">
                            <h3 class="product-name">{{ product.name }}</h3>
                            <p class="product-description">
                                {{ product.description|truncatewords:20 }}
                            </p>

                            <div class="product-meta">
                                <div class="price-section">
                                    <span class="price-value">{{ product.price }}</span>
                                    <span class="price-currency">BYN</span>
                                </div>

                                {% if product.stock > 0 %}
                                <div class="stock-info">
                                    <span class="stock-label">–û—Å—Ç–∞—Ç–æ–∫:</span>
                                    <span class="stock-count">{{ product.stock }} —à—Ç.</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                        <div class="card-footer">
                            <div class="action-buttons">
                                <a href="{% url 'delivery_app:product_detail' product.id %}" class="detail-btn"
                                    title="–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–æ–≤–∞—Ä–µ">
                                    <span class="btn-icon">üëÅÔ∏è</span>
                                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                </a>

                                {% if product.stock > 0 %}
                                <form method="post" action="{% url 'delivery_app:add_to_cart' product.id %}"
                                    class="add-to-cart-form">
                                    {% csrf_token %}
                                    <div class="quantity-section">
                                        <label for="quantity-{{ product.id }}">–ö–æ–ª-–≤–æ:</label>
                                        <input type="number" id="quantity-{{ product.id }}" name="quantity" value="1"
                                            min="1" max="{{ product.stock }}" class="quantity-input">
                                    </div>
                                    <button type="submit" class="cart-btn" 
                                            data-product-id="{{ product.id }}"
                                            data-product-name="{{ product.name }}"
                                            data-product-image="{% if product.image %}{{ product.image.url }}{% else %}{% static 'delivery_app/images/default-product.png' %}{% endif %}">
                                        <span class="btn-icon">üõí</span>
                                        –í –∫–æ—Ä–∑–∏–Ω—É
                                    </button>
                                </form>
                                {% else %}
                                <button class="cart-btn disabled" disabled>
                                    <span class="btn-icon">‚õî</span>
                                    –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ
                                </button>
                                {% endif %}
                            </div>
                        </div>
                    </article>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ -->
            <div class="empty-state" data-scroll="zoomIn">
                <div class="empty-icon">üì¶</div>
                <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
                <a href="{% url 'delivery_app:product_list' %}?per_page={{ per_page }}" class="reset-btn large">
                    <span class="btn-icon">üîÑ</span>
                    –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã
                </a>
            </div>
            {% endif %}
        </div>

        <!-- –ø–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div class="pagination-section" data-scroll="fadeInUp">
            <!-- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º -->
            <div class="pagination-controls">
                <!-- –≤—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
                <div class="per-page-selector">
                    <form method="get" class="per-page-form">
                        <!-- —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–æ–º–µ page –∏ per_page -->
                        {% for key, value in request.GET.items %}
                        {% if key != 'page' and key != 'per_page' %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                        {% endif %}
                        {% endfor %}

                        <div class="form-group">
                            <label for="per_page" class="form-label">–¢–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
                            <select name="per_page" id="per_page" class="form-select" onchange="this.form.submit()">
                                <option value="3" {% if per_page == 3 %}selected{% endif %}>3</option>
                                <option value="6" {% if per_page == 6 %}selected{% endif %}>6</option>
                                <option value="9" {% if per_page == 9 %}selected{% endif %}>9</option>
                                <option value="12" {% if per_page == 12 %}selected{% endif %}>12</option>
                            </select>
                        </div>
                    </form>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
                <div class="page-info">
                    <span class="info-text">
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ <strong>{{ page_obj.number }}</strong> –∏–∑ <strong>{{ paginator.num_pages }}</strong>
                    </span>
                    <span class="info-text">
                        –ü–æ–∫–∞–∑–∞–Ω–æ <strong>{{ page_obj.start_index }}-{{ page_obj.end_index }}</strong> –∏–∑ <strong>{{ paginator.count }}</strong> —Ç–æ–≤–∞—Ä–æ–≤
                    </span>
                </div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º -->
            {% if is_paginated and paginator.num_pages > 1 %}
            <nav class="pagination-nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º">
                <ul class="pagination">
                    <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
                    {% if page_obj.number > 3 %}
                    <li class="page-item">
                        <a class="page-link" href="?{% url_replace page=1 %}" aria-label="–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">
                            <span aria-hidden="true">¬´¬´</span>
                        </a>
                    </li>
                    {% endif %}

                    <!-- –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
                    {% if page_obj.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?{% url_replace page=page_obj.previous_page_number %}"
                            aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∞—è">
                            <span aria-hidden="true">‚Äπ</span>
                        </a>
                    </li>
                    {% else %}
                    <li class="page-item disabled">
                        <span class="page-link" aria-hidden="true">‚Äπ</span>
                    </li>
                    {% endif %}

                    <!-- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü —Å —É–º–Ω—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º -->
                    {% for num in paginator.page_range %}
                    {% if num == page_obj.number %}
                    <li class="page-item active" aria-current="page">
                        <span class="page-link">{{ num }}</span>
                    </li>
                    {% else %}
                    {% if num <= page_obj.number|add:2 and num >= page_obj.number|add:-2 %}
                        <li class="page-item">
                            <a class="page-link" href="?{% url_replace page=num %}">{{ num }}</a>
                        </li>
                        {% elif num == 1 or num == paginator.num_pages %}
                        <li class="page-item">
                            <a class="page-link" href="?{% url_replace page=num %}">{{ num }}</a>
                        </li>
                        {% elif num == page_obj.number|add:3 or num == page_obj.number|add:-3 %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                        {% endif %}
                        {% endif %}
                        {% endfor %}

                        <!-- –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?{% url_replace page=page_obj.next_page_number %}"
                                aria-label="–°–ª–µ–¥—É—é—â–∞—è">
                                <span aria-hidden="true">‚Ä∫</span>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <span class="page-link" aria-hidden="true">‚Ä∫</span>
                        </li>
                        {% endif %}

                        <!-- –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
                        {% if page_obj.number < paginator.num_pages|add:-2 %} <li class="page-item">
                            <a class="page-link" href="?{% url_replace page=paginator.num_pages %}"
                                aria-label="–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞">
                                <span aria-hidden="true">¬ª¬ª</span>
                            </a>
                            </li>
                            {% endif %}
                </ul>
            </nav>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* === –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò === */
    .products-simple * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    .products-simple {
        max-width: 1400px;
        margin: 80px auto 40px;
        padding: 0 20px;
        font-family: 'Inter', Arial, sans-serif;
        line-height: 1.5;
    }

        /* === –ê–ù–ò–ú–ê–¶–ò–ò –ü–†–ò –°–ö–†–û–õ–õ–ò–ù–ì–ï === */
    [data-scroll] {
        opacity: 0;
        transform: translateY(50px);
        transition: all 0.8s ease;
    }

    [data-scroll].visible {
        opacity: 1;
        transform: translateY(0);
    }

    /* –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ */
    .fadeInUp.visible { opacity: 1; transform: translateY(0); }
    .slideInDown.visible { opacity: 1; transform: translateY(0); }
    .zoomIn.visible { opacity: 1; transform: scale(1); }

    .fadeInUp { opacity: 0; transform: translateY(50px); }
    .slideInDown { opacity: 0; transform: translateY(-50px); }
    .zoomIn { opacity: 0; transform: scale(0.8); }

    /* === –ó–ê–ì–û–õ–û–í–û–ö –° –ê–ù–ò–ú–ê–¶–ò–ï–ô –ß–ê–°–¢–ò–¶ === */
    .simple-header {
        position: relative;
        background: linear-gradient(135deg, #adbcff 0%, #cf9fff 100%);
        color: white;
        padding: 25px 30px;
        border-radius: 8px;
        margin-bottom: 30px;
        text-align: center;
        overflow: hidden;
        min-height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #particleCanvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
    }

    .header-content {
        position: relative;
        z-index: 2;
        width: 100%;
    }

    .simple-header h1 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .header-info {
        font-size: 14px;
        opacity: 0.9;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    /* === –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –ö–û–†–ó–ò–ù–ê === */
    .floating-cart {
        position: fixed;
        top: 120px;
        right: 30px;
        z-index: 1000;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .floating-cart:hover {
        transform: scale(1.1);
    }

    .cart-icon {
        position: relative;
        font-size: 2em;
        background: #2c5aa0;
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(44, 90, 160, 0.3);
    }

    .cart-count {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7em;
        font-weight: bold;
        animation: pulse 2s infinite;
    }

    .cart-tooltip {
        position: absolute;
        top: 100%;
        right: 0;
        background: #333;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.8em;
        white-space: nowrap;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        pointer-events: none;
    }

    .floating-cart:hover .cart-tooltip {
        opacity: 1;
        transform: translateY(5px);
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã */
    @keyframes bounce {
        0%, 20%, 60%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        80% { transform: translateY(-5px); }
    }

    .cart-bounce {
        animation: bounce 0.5s ease;
    }

    /* === –õ–ï–¢–ê–Æ–©–ò–ô –ü–†–û–î–£–ö–¢ === */
    .flying-product {
        position: fixed;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        z-index: 999;
        pointer-events: none;
        transition: all 0.1s linear;
    }

    .flying-product img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
    @keyframes successAdd {
        0% { background: #28a745; transform: scale(1); }
        50% { background: #20c997; transform: scale(1.1); }
        100% { background: #28a745; transform: scale(1); }
    }

    .success-add {
        animation: successAdd 0.5s ease;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
    .simple-content {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 30px;
    }

    /* === –§–û–†–ú–ê –§–ò–õ–¨–¢–†–ê–¶–ò–ò === */
    .filter-section {
        margin-bottom: 30px;
        padding-bottom: 25px;
        border-bottom: 1px solid #e0e0e0;
    }

    .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        align-items: end;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .filter-group label {
        font-weight: 600;
        color: #2c5aa0;
        font-size: 14px;
    }

    .filter-group input,
    .filter-group select {
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .filter-group input:focus,
    .filter-group select:focus {
        outline: none;
        border-color: #2c5aa0;
        box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
    }

    .filter-actions {
        display: flex;
        gap: 10px;
        align-items: end;
    }

    .filter-btn,
    .reset-btn {
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s ease;
    }

    .filter-btn {
        background: #2c5aa0;
        color: white;
    }

    .filter-btn:hover {
        background: #1e3d6f;
        transform: translateY(-1px);
    }

    .reset-btn {
        background: #6c757d;
        color: white;
    }

    .reset-btn:hover {
        background: #5a6268;
        transform: translateY(-1px);
    }

    .btn-icon {
        font-size: 12px;
    }

    /* === CSS GRID LAYOUT –î–õ–Ø –¢–û–í–ê–†–û–í === */
    .products-grid-container {
        margin-top: 20px;
    }

    .grid-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding: 0 10px;
    }

    .grid-header h2 {
        color: #2c5aa0;
        font-size: 20px;
        margin: 0;
    }

    .products-count {
        color: #6c757d;
        font-size: 14px;
        background: #f8f9fa;
        padding: 6px 12px;
        border-radius: 15px;
    }

    /* –û—Å–Ω–æ–≤–Ω–∞—è CSS Grid —Å–µ—Ç–∫–∞ */
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        align-items: stretch;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ */
    .product-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .product-card:hover {
        border-color: #2c5aa0;
        box-shadow: 0 8px 25px rgba(44, 90, 160, 0.15);
        transform: translateY(-5px);
    }

    /* –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .card-header {
        position: relative;
        background: #f8f9fa;
        padding: 0;
    }

    .product-image-container {
        position: relative;
        height: 200px;
        overflow: hidden;
    }

    .product-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .product-card:hover .product-image {
        transform: scale(1.05);
    }

    .product-image-placeholder {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
    }

    .placeholder-icon {
        font-size: 48px;
        opacity: 0.5;
    }

    /* –ë–µ–π–¥–∂ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
    .category-badge {
        position: absolute;
        top: 12px;
        left: 12px;
        background: rgba(44, 90, 160, 0.9);
        color: white;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
        backdrop-filter: blur(10px);
    }

    /* –°—Ç–∞—Ç—É—Å –Ω–∞–ª–∏—á–∏—è */
    .stock-status {
        position: absolute;
        top: 12px;
        right: 12px;
        padding: 6px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
        backdrop-filter: blur(10px);
    }

    .stock-status.in-stock {
        background: rgba(40, 167, 69, 0.9);
        color: white;
    }

    .stock-status.out-of-stock {
        background: rgba(220, 53, 69, 0.9);
        color: white;
    }

    /* –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
    .card-body {
        padding: 20px;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .product-name {
        color: #2c5aa0;
        font-size: 18px;
        font-weight: 600;
        margin: 0;
        line-height: 1.3;
    }

    .product-description {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
        margin: 0;
        flex: 1;
    }

    .product-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: auto;
    }

    .price-section {
        display: flex;
        align-items: baseline;
        gap: 4px;
    }

    .price-value {
        font-size: 20px;
        font-weight: 700;
        color: #28a745;
    }

    .price-currency {
        font-size: 14px;
        color: #6c757d;
    }

    .stock-info {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 2px;
    }

    .stock-label {
        font-size: 12px;
        color: #6c757d;
    }

    .stock-count {
        font-size: 14px;
        font-weight: 600;
        color: #28a745;
    }

    /* –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .card-footer {
        padding: 0 20px 20px;
        border-top: 1px solid #f0f0f0;
        margin-top: 15px;
        padding-top: 15px;
    }

    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .detail-btn {
        background: #17a2b8;
        color: white;
        padding: 10px 16px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 14px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        transition: all 0.2s ease;
        font-weight: 500;
    }

    .detail-btn:hover {
        background: #138496;
        transform: translateY(-1px);
    }

    .add-to-cart-form {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .quantity-section {
        display: flex;
        align-items: center;
        gap: 6px;
        flex: 1;
    }

    .quantity-section label {
        font-size: 12px;
        color: #666;
        font-weight: 500;
        white-space: nowrap;
    }

    .quantity-input {
        width: 60px;
        padding: 6px;
        border: 1px solid #ddd;
        border-radius: 4px;
        text-align: center;
        font-size: 14px;
    }

    .quantity-input:focus {
        outline: none;
        border-color: #2c5aa0;
    }

    .cart-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        transition: all 0.2s ease;
        font-weight: 500;
        flex: 2;
    }

    .cart-btn:hover:not(:disabled) {
        background: #218838;
        transform: translateY(-1px);
    }

    .cart-btn:disabled,
    .cart-btn.disabled {
        background: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
        transform: none;
    }

    /* –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
        background: #f8f9fa;
        border-radius: 8px;
        border: 2px dashed #e0e0e0;
        margin-top: 30px;
    }

    .empty-icon {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
    }

    .empty-state h3 {
        color: #333;
        margin-bottom: 10px;
    }

    .empty-state p {
        margin-bottom: 20px;
    }

    .reset-btn.large {
        padding: 12px 24px;
        font-size: 16px;
    }

/* === –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ü–ê–ì–ò–ù–ê–¶–ò–Ø === */
.pagination-section {
    margin-top: 40px;
    padding-top: 25px;
    border-top: 1px solid #e8ecef;
}

.pagination-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 20px;
}

.per-page-selector {
    display: flex;
    align-items: center;
}

.per-page-form .form-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 0;
}

.form-label {
    font-weight: 600;
    color: #495057;
    font-size: 14px;
    white-space: nowrap;
}

.form-select {
    padding: 8px 12px;
    border: 1px solid #ced4da;
    border-radius: 6px;
    font-size: 14px;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 70px;
}

.form-select:focus {
    outline: none;
    border-color: #2c5aa0;
    box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
}

.page-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
    text-align: right;
}

.info-text {
    font-size: 14px;
    color: #6c757d;
}

.info-text strong {
    color: #2c5aa0;
    font-weight: 600;
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
.pagination-nav {
    display: flex;
    justify-content: center;
}

.pagination {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 6px;
    align-items: center;
}

.page-item {
    margin: 0;
}

.page-link {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    color: #2c5aa0;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    min-width: 42px;
    height: 42px;
    transition: all 0.3s ease;
    background: white;
    position: relative;
}

.page-link:hover {
    background: #2c5aa0;
    color: white;
    border-color: #2c5aa0;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(44, 90, 160, 0.2);
}

.page-item.active .page-link {
    background: #2c5aa0;
    color: white;
    border-color: #2c5aa0;
    box-shadow: 0 2px 8px rgba(44, 90, 160, 0.3);
}

.page-item.disabled .page-link {
    color: #adb5bd;
    background: #f8f9fa;
    border-color: #dee2e6;
    cursor: not-allowed;
    opacity: 0.6;
    transform: none;
    box-shadow: none;
}

.page-item.disabled .page-link:hover {
    background: #f8f9fa;
    color: #adb5bd;
    border-color: #dee2e6;
    transform: none;
    box-shadow: none;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü */
.pagination-section {
    animation: fadeInUp 0.5s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .pagination-controls {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
    }
    
    .per-page-form .form-group {
        justify-content: center;
    }
    
    .page-info {
        text-align: center;
        order: -1;
    }
    
    .pagination {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .page-link {
        padding: 6px 10px;
        min-width: 38px;
        height: 38px;
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .pagination-section {
        margin-top: 30px;
        padding-top: 20px;
    }
    
    .pagination-controls {
        gap: 15px;
    }
    
    .page-info {
        font-size: 13px;
    }
    
    .form-label {
        font-size: 13px;
    }
    
    .form-select {
        padding: 6px 10px;
        font-size: 13px;
    }
    
    .pagination {
        gap: 4px;
    }
    
    .page-link {
        padding: 5px 8px;
        min-width: 36px;
        height: 36px;
        font-size: 12px;
    }
}

/* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
.pagination-section * {
    transition: all 0.3s ease;
}

/* –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å */
.page-link:focus {
    outline: 2px solid #2c5aa0;
    outline-offset: 2px;
}

.page-item.active .page-link:focus {
    outline-color: white;
}

/* –ú–∏–∫—Ä–æ-–∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
@keyframes gentlePulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.page-link:hover {
    animation: gentlePulse 0.3s ease;
}
    /* === –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ CSS GRID === */
    @media (max-width: 1200px) {
        .products-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .filter-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .products-simple {
            margin: 70px auto 30px;
            padding: 0 15px;
        }

        .simple-header {
            padding: 20px;
        }

        .simple-header h1 {
            font-size: 20px;
        }

        .simple-content {
            padding: 20px;
        }

        .filter-grid {
            grid-template-columns: 1fr;
        }

        .filter-actions {
            flex-direction: column;
        }

        .grid-header {
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è CSS Grid –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .products-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .add-to-cart-form {
            flex-direction: column;
        }

        .quantity-section {
            justify-content: space-between;
        }
    }

    @media (max-width: 480px) {
        .simple-header {
            padding: 15px;
        }

        .simple-content {
            padding: 15px;
        }

        /* –û–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
        .products-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .product-image-container {
            height: 180px;
        }

        .card-body {
            padding: 15px;
        }

        .card-footer {
            padding: 0 15px 15px;
        }

        .empty-state {
            padding: 40px 15px;
        }
    }

    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è CSS Grid */
    .products-grid {
        /* –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–µ—Ç–∫–∏ */
        animation: fadeInUp 0.6s ease-out;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Å–µ–≤–¥–æ–∫–ª–∞—Å—Å–æ–≤ */
    .product-card:nth-child(odd) {
        background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
    }

    .product-card:nth-child(even) {
        background: linear-gradient(135deg, #fafafa 0%, #ffffff 100%);
    }

    .product-card:focus-within {
        border-color: #2c5aa0;
        box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤ */
    .product-card[data-stock="0"] {
        opacity: 0.7;
        background: linear-gradient(135deg, #fff5f5 0%, #ffeaea 100%);
    }

    .product-card[data-stock="0"]:hover {
        opacity: 0.9;
    }

    /* –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
    ::selection {
        background-color: #2c5aa0;
        color: white;
    }

    ::-moz-selection {
        background-color: #2c5aa0;
        color: white;
    }

    /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã */
    .product-card,
    .filter-btn,
    .reset-btn,
    .detail-btn,
    .cart-btn {
        transition: all 0.3s ease;
    }

    /* –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º */
    .quantity-input:invalid {
        border-color: #dc3545;
        background-color: #fff5f5;
    }

    .quantity-input:valid {
        border-color: #28a745;
        background-color: #f8fff9;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // –∞—Ç—Ä–∏–±—É—Ç data-stock –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
        document.querySelectorAll('.product-card').forEach(card => {
            const stockStatus = card.querySelector('.stock-status.out-of-stock');
            if (stockStatus) {
                card.setAttribute('data-stock', '0');
            }
        });

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ
        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', function () {
                const max = parseInt(this.getAttribute('max'));
                const value = parseInt(this.value);

                if (value > max) {
                    this.value = max;
                    this.reportValidity();
                }

                if (value < 1) {
                    this.value = 1;
                }
            });

            input.addEventListener('input', function () {
                if (this.validity.rangeOverflow) {
                    this.setCustomValidity('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ' + this.getAttribute('max'));
                } else if (this.validity.rangeUnderflow) {
                    this.setCustomValidity('–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 1');
                } else {
                    this.setCustomValidity('');
                }
            });
        });

        // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å–µ—Ç–∫–µ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        const filterForm = document.querySelector('.product-filter-form');
        if (filterForm) {
            filterForm.addEventListener('submit', function () {
                setTimeout(() => {
                    document.querySelector('.products-section').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 100);
            });
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        const productCards = document.querySelectorAll('.product-card');
        productCards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
    function updateProductsCount() {
        const productsGrid = document.querySelector('.products-grid');
        const productCards = productsGrid.querySelectorAll('.product-card:not([style*="display: none"])');
        const productsCount = document.querySelector('.products-count');

        if (productsCount && productCards.length > 0) {
            productsCount.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ ${productCards.length} —Ç–æ–≤–∞—Ä–æ–≤`;
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω—ã –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    document.addEventListener('DOMContentLoaded', function () {
        const perPageSelect = document.getElementById('per_page');
        if (perPageSelect) {
            perPageSelect.addEventListener('change', function () {
                // –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                const productsSection = document.querySelector('.products-section');
                if (productsSection) {
                    productsSection.style.opacity = '0.7';
                    productsSection.style.transition = 'opacity 0.3s ease';
                }
            });
        }

        // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –≤–µ—Ä—Ö—É –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        const paginationLinks = document.querySelectorAll('.page-link[href*="page="]');
        paginationLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (href && href.includes('page=')) {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                    // –≤—Ä–µ–º—è –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
                    setTimeout(() => {
                        window.location.href = href;
                    }, 300);
                }
            });
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        updateProductsCount();
    });
    
    // –∞–Ω–∏–º–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü
    class ParticleBackground {
        constructor() {
            this.canvas = document.getElementById('particleCanvas');
            this.ctx = this.canvas.getContext('2d');
            this.particles = [];
            this.mouse = { x: null, y: null, radius: 120 };
            this.scrollY = 0;
            this.lastScrollY = 0;
            this.scrollVelocity = 0;
            this.isHeaderVisible = true;
            this.headerElement = document.querySelector('.simple-header');
            this.cumulativeScroll = 0;
            
            this.init();
            this.animate();
            
            window.addEventListener('resize', () => this.resize());
            window.addEventListener('mousemove', (e) => this.handleMouseMove(e));
            window.addEventListener('scroll', () => this.handleScroll());
            
            this.createHeaderObserver();
        }
        
        init() {
            this.resize();
            this.createParticles();
        }
        
        resize() {
            const header = document.querySelector('.simple-header');
            this.canvas.width = header.offsetWidth;
            this.canvas.height = header.offsetHeight;
            this.createParticles();
        }
        
        createParticles() {
            this.particles = [];
            const particleCount = 80; // –£–º–µ—Ä–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            
            const colors = [
                'rgba(255, 255, 255, 0.8)',
                'rgba(255, 240, 245, 0.8)',
                'rgba(220, 230, 255, 0.8)',
                'rgba(255, 230, 240, 0.8)',
                'rgba(240, 255, 240, 0.8)'
            ];
            
            for (let i = 0; i < particleCount; i++) {
                this.particles.push({
                    x: Math.random() * this.canvas.width,
                    y: Math.random() * this.canvas.height,
                    size: Math.random() * 4 + 2, // —Ä–∞–∑–º–µ—Ä
                    baseSpeedX: Math.random() * 1 - 0.5,
                    baseSpeedY: Math.random() * 1 - 0.5,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    originalX: Math.random() * this.canvas.width,
                    originalY: Math.random() * this.canvas.height,
                    amplitude: Math.random() * 2 + 1, // –∞–º–ø–ª–∏—Ç—É–¥–∞
                    targetX: Math.random() * this.canvas.width,
                    targetY: Math.random() * this.canvas.height,
                    scatterFactor: Math.random() * 1 + 0.5 // —Ñ–∞–∫—Ç–æ—Ä —Ä–∞–∑–ª–µ—Ç–∞
                });
                
                this.particles[i].targetX = this.particles[i].originalX;
                this.particles[i].targetY = this.particles[i].originalY;
            }
        }
        
        createHeaderObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const wasVisible = this.isHeaderVisible;
                    this.isHeaderVisible = entry.isIntersecting;
                    
                    if (this.isHeaderVisible && !wasVisible && this.scrollVelocity < 0) {
                        this.returnParticlesToOriginal();
                        this.cumulativeScroll = 0;
                    }
                });
            }, {
                threshold: 0.3
            });
            
            observer.observe(this.headerElement);
        }
        
        returnParticlesToOriginal() {
            for (let particle of this.particles) {
                particle.targetX = particle.originalX;
                particle.targetY = particle.originalY;
            }
        }
        
        handleScroll() {
            const newScrollY = window.scrollY;
            this.scrollVelocity = newScrollY - this.lastScrollY;
            this.lastScrollY = newScrollY;
            
            // –£–º–µ—Ä–µ–Ω–Ω–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ
            if (Math.abs(this.scrollVelocity) > 1) {
                this.cumulativeScroll += Math.abs(this.scrollVelocity) * 0.03;
                this.cumulativeScroll = Math.min(this.cumulativeScroll, 20);
            }
            
            // –£–º–µ—Ä–µ–Ω–Ω—ã–π —Ä–∞–∑–ª–µ—Ç –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –≤–Ω–∏–∑
            if (this.scrollVelocity > 2 && this.isHeaderVisible) {
                this.scatterParticles();
            }
        }
        
        scatterParticles() {
            const centerX = this.canvas.width / 2;
            const centerY = this.canvas.height / 2;
            
            // —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞–∑–ª–µ—Ç–∞
            const baseScatterStrength = Math.min(this.scrollVelocity * 0.3, 15);
            const cumulativeBoost = this.cumulativeScroll * 0.8;
            const totalScatterStrength = baseScatterStrength + cumulativeBoost;
            
            for (let particle of this.particles) {
                // —Å–ª—É—á–∞–π–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
                const randomAngle = (Math.random() - 0.5) * 0.3;
                const angle = Math.atan2(
                    particle.y - centerY,
                    particle.x - centerX
                ) + randomAngle;
                
                // –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Å–∏–ª–∞
                const individualStrength = totalScatterStrength * particle.scatterFactor * particle.amplitude;
                
                particle.targetX = particle.x + Math.cos(angle) * individualStrength;
                particle.targetY = particle.y + Math.sin(angle) * individualStrength;
                
                // –≥—Ä–∞–Ω–∏—Ü—ã
                const margin = 100;
                particle.targetX = Math.max(-margin, Math.min(this.canvas.width + margin, particle.targetX));
                particle.targetY = Math.max(-margin, Math.min(this.canvas.height + margin, particle.targetY));
            }
        }
        
        handleMouseMove(e) {
            const rect = this.canvas.getBoundingClientRect();
            this.mouse.x = e.clientX - rect.left;
            this.mouse.y = e.clientY - rect.top;
        }
        
        animate() {
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            
            // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–µ–≤—ã–º –ø–æ–∑–∏—Ü–∏—è–º
            for (let particle of this.particles) {
                const dx = particle.targetX - particle.x;
                const dy = particle.targetY - particle.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // –£–º–µ—Ä–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è
                const speed = Math.min(0.08 + distance * 0.001, 0.2);
                particle.x += dx * speed;
                particle.y += dy * speed;
                
                // –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –º—ã—à—å—é
                if (this.mouse.x !== null && this.mouse.y !== null) {
                    const dxMouse = particle.x - this.mouse.x;
                    const dyMouse = particle.y - this.mouse.y;
                    const mouseDistance = Math.sqrt(dxMouse * dxMouse + dyMouse * dyMouse);
                    
                    if (mouseDistance < this.mouse.radius) {
                        const force = (this.mouse.radius - mouseDistance) / this.mouse.radius;
                        const angle = Math.atan2(dyMouse, dxMouse);
                        particle.x += Math.cos(angle) * force * 4;
                        particle.y += Math.sin(angle) * force * 4;
                        
                        particle.targetX = particle.x;
                        particle.targetY = particle.y;
                    }
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
            for (let i = 0; i < this.particles.length; i++) {
                for (let j = i + 1; j < this.particles.length; j++) {
                    const dx = this.particles[i].x - this.particles[j].x;
                    const dy = this.particles[i].y - this.particles[j].y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 120) {
                        this.ctx.beginPath();
                        const opacity = 0.3 * (1 - distance/120);
                        this.ctx.strokeStyle = `rgba(255, 255, 255, ${opacity})`;
                        this.ctx.lineWidth = 1;
                        this.ctx.moveTo(this.particles[i].x, this.particles[i].y);
                        this.ctx.lineTo(this.particles[j].x, this.particles[j].y);
                        this.ctx.stroke();
                    }
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Å—Ç–∏—Ü
            for (let particle of this.particles) {
                const glowRadius = particle.size * 3;
                const gradient = this.ctx.createRadialGradient(
                    particle.x, particle.y, 0,
                    particle.x, particle.y, glowRadius
                );
                gradient.addColorStop(0, particle.color);
                gradient.addColorStop(0.7, particle.color.replace('0.8', '0.3'));
                gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                
                this.ctx.beginPath();
                this.ctx.arc(particle.x, particle.y, glowRadius, 0, Math.PI * 2);
                this.ctx.fillStyle = gradient;
                this.ctx.fill();
                
                this.ctx.beginPath();
                this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                this.ctx.fillStyle = particle.color;
                this.ctx.fill();
                
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
                this.ctx.lineWidth = 1;
                this.ctx.stroke();
            }
            
            requestAnimationFrame(() => this.animate());
        }
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–µ
    class ScrollAnimation {
        constructor() {
            this.elements = document.querySelectorAll('[data-scroll]');
            this.init();
        }

        init() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        this.animateElement(entry.target, true);
                    } else {
                        const rect = entry.target.getBoundingClientRect();
                        if (rect.top < 0) {
                            this.animateElement(entry.target, false);
                        }
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            this.elements.forEach(element => {
                observer.observe(element);
            });
        }

        animateElement(element, isEntering) {
            const animationType = element.getAttribute('data-scroll');
            const delay = element.getAttribute('data-scroll-delay') || 0;
            
            setTimeout(() => {
                if (isEntering) {
                    element.classList.add('visible');
                    if (animationType) {
                        element.classList.add(animationType);
                    }
                } else {
                    element.classList.remove('visible');
                    if (animationType) {
                        element.classList.remove(animationType);
                    }
                }
            }, delay);
        }
    }
    // –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
    class CartAnimation {
        constructor() {
            this.cartCount = 0;
            this.cartElement = document.getElementById('cartCount');
            this.cartButton = document.getElementById('floatingCart');
            this.init();
        }

        init() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–í –∫–æ—Ä–∑–∏–Ω—É"
            document.addEventListener('submit', (e) => {
                if (e.target.classList.contains('add-to-cart-form')) {
                    e.preventDefault();
                    this.handleAddToCart(e.target);
                }
            });

            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
            this.cartButton.addEventListener('click', () => {
                this.bounceCart();
            });
        }

        handleAddToCart(form) {
            const button = form.querySelector('.cart-btn');
            const productId = button.getAttribute('data-product-id');
            const productName = button.getAttribute('data-product-name');
            const productImage = button.getAttribute('data-product-image');
            const quantity = form.querySelector('.quantity-input').value;

            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
            this.animateButton(button);

            // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ—Ç–∞—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
            this.createFlyingProduct(button, productImage);

            // –£–≤–µ–ª–∏—á–∏–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
            this.cartCount += parseInt(quantity);
            this.updateCartCount();

            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã AJAX –∑–∞–ø—Ä–æ—Å
            console.log(`–¢–æ–≤–∞—Ä ${productName} (${quantity} —à—Ç.) –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`);

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                form.submit();
            }, 1000);
        }

        animateButton(button) {
            button.classList.add('success-add');
            button.innerHTML = '<span class="btn-icon">‚úÖ</span> –î–æ–±–∞–≤–ª–µ–Ω–æ!';
            button.disabled = true;

            setTimeout(() => {
                button.classList.remove('success-add');
                button.innerHTML = '<span class="btn-icon">üõí</span> –í –∫–æ—Ä–∑–∏–Ω—É';
                button.disabled = false;
            }, 2000);
        }

        createFlyingProduct(button, productImage) {
            const buttonRect = button.getBoundingClientRect();
            const cartRect = this.cartButton.getBoundingClientRect();

            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–æ–¥—É–∫—Ç–∞
            const flyingProduct = document.createElement('div');
            flyingProduct.className = 'flying-product';
            
            if (productImage) {
                const img = document.createElement('img');
                img.src = productImage;
                img.alt = 'Product';
                flyingProduct.appendChild(img);
            } else {
                flyingProduct.innerHTML = 'üì¶';
            }
            
            document.body.appendChild(flyingProduct);

            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–Ω–æ–ø–∫–∏
            flyingProduct.style.left = buttonRect.left + 'px';
            flyingProduct.style.top = buttonRect.top + 'px';
            
            // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–ª–µ—Ç–∞
            requestAnimationFrame(() => {
                flyingProduct.style.transition = 'all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1)';
                flyingProduct.style.left = cartRect.left + 'px';
                flyingProduct.style.top = cartRect.top + 'px';
                flyingProduct.style.transform = 'scale(0.5)';
                flyingProduct.style.opacity = '0.5';
            });

            // –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                if (flyingProduct.parentNode) {
                    flyingProduct.parentNode.removeChild(flyingProduct);
                }
                this.bounceCart();
            }, 800);
        }

        updateCartCount() {
            this.cartElement.textContent = this.cartCount;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞
            this.cartElement.style.transform = 'scale(1.3)';
            setTimeout(() => {
                this.cartElement.style.transform = 'scale(1)';
            }, 300);
        }

        bounceCart() {
            this.cartButton.classList.add('cart-bounce');
            setTimeout(() => {
                this.cartButton.classList.remove('cart-bounce');
            }, 500);
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–π
        new ParticleBackground();
        new ScrollAnimation();
        new CartAnimation();

        console.log('–ê–Ω–∏–º–∞—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');

        // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', function() {
                const max = parseInt(this.getAttribute('max'));
                const value = parseInt(this.value);

                if (value > max) {
                    this.value = max;
                }

                if (value < 1) {
                    this.value = 1;
                }
            });
        });
    });
</script>
{% endblock %}