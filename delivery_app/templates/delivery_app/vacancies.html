{% extends "delivery_app/base.html" %}
{% load static %}

{% block title %}
–í–∞–∫–∞–Ω—Å–∏–∏
{% endblock %}

{% block content %}
<div class="vacancies-container">
    <div class="page-header">
        <h1>–ö–∞—Ä—å–µ—Ä–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h1>
        <p class="page-subtitle">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</p>
        <p class="current-date">–î–∞—Ç–∞: {{ current_date }} | –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞: {{ timezone }}</p>
    </div>

    <!-- –ë–ª–æ–∫ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –∫–ª–∞—Å—Å–æ–≤ -->
    <div class="demo-section">
        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏—è–º–∏</h2>
        
        <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–π -->
        <div class="form-section">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–∞–∫–∞–Ω—Å–∏—é</h3>
            <form id="vacancyForm">
                <div class="form-group">
                    <label for="profession">–ü—Ä–æ—Ñ–µ—Å—Å–∏—è:</label>
                    <input type="text" id="profession" name="profession" required 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–æ–¥–∏—Ç–µ–ª—å-–∫—É—Ä—å–µ—Ä">
                </div>
                <div class="form-group">
                    <label for="salary">–ó–∞—Ä–ø–ª–∞—Ç–∞ (BYN):</label>
                    <input type="number" id="salary" name="salary" required 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1500" min="0">
                </div>
                <div class="form-group">
                    <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="tel" id="phone" name="phone" required 
                           placeholder="+375 (XX) XXX-XX-XX" 
                           pattern="\+375\s?\(?(25|29|33|44)\)?\s?\d{3}-?\d{2}-?\d{2}">
                    <small class="phone-format">–§–æ—Ä–º–∞—Ç: +375 (XX) XXX-XX-XX</small>
                </div>
                <div class="form-group">
                    <label for="city">–ì–æ—Ä–æ–¥:</label>
                    <select id="city" name="city" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                        <option value="–ú–∏–Ω—Å–∫">–ú–∏–Ω—Å–∫</option>
                        <option value="–ì—Ä–æ–¥–Ω–æ">–ì—Ä–æ–¥–Ω–æ</option>
                        <option value="–ë—Ä–µ—Å—Ç">–ë—Ä–µ—Å—Ç</option>
                        <option value="–ì–æ–º–µ–ª—å">–ì–æ–º–µ–ª—å</option>
                        <option value="–í–∏—Ç–µ–±—Å–∫">–í–∏—Ç–µ–±—Å–∫</option>
                        <option value="–ú–æ–≥–∏–ª–µ–≤">–ú–æ–≥–∏–ª–µ–≤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" 
                           placeholder="hr@company.by">
                </div>
                <div class="form-group">
                    <label for="experience">–¢—Ä–µ–±—É–µ–º—ã–π –æ–ø—ã—Ç:</label>
                    <select id="experience" name="experience">
                        <option value="–ë–µ–∑ –æ–ø—ã—Ç–∞">–ë–µ–∑ –æ–ø—ã—Ç–∞</option>
                        <option value="1-3 –≥–æ–¥–∞">1-3 –≥–æ–¥–∞</option>
                        <option value="3-5 –ª–µ—Ç">3-5 –ª–µ—Ç</option>
                        <option value="–ë–æ–ª–µ–µ 5 –ª–µ—Ç">–ë–æ–ª–µ–µ 5 –ª–µ—Ç</option>
                    </select>
                </div>
                <button type="submit" class="btn-add">–î–æ–±–∞–≤–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</button>
                <button type="button" onclick="clearAllVacancies()" class="btn-clear">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            </form>
        </div>

        <!-- –ë–ª–æ–∫–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div class="results-section">
            <div class="results-column">
                <h3>–í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏ <span id="vacanciesCount"></span></h3>
                <div class="filter-section">
                    <label for="cityFilter">–§–∏–ª—å—Ç—Ä –ø–æ –≥–æ—Ä–æ–¥—É:</label>
                    <select id="cityFilter" onchange="filterByCity()">
                        <option value="">–í—Å–µ –≥–æ—Ä–æ–¥–∞</option>
                        <option value="–ú–∏–Ω—Å–∫">–ú–∏–Ω—Å–∫</option>
                        <option value="–ì—Ä–æ–¥–Ω–æ">–ì—Ä–æ–¥–Ω–æ</option>
                        <option value="–ë—Ä–µ—Å—Ç">–ë—Ä–µ—Å—Ç</option>
                        <option value="–ì–æ–º–µ–ª—å">–ì–æ–º–µ–ª—å</option>
                        <option value="–í–∏—Ç–µ–±—Å–∫">–í–∏—Ç–µ–±—Å–∫</option>
                        <option value="–ú–æ–≥–∏–ª–µ–≤">–ú–æ–≥–∏–ª–µ–≤</option>
                    </select>
                    <button onclick="sortBySalary()" class="btn-sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ</button>
                </div>
                <div id="allVacancies"></div>
            </div>
            <div class="results-column">
                <h3>–í—ã—Å–æ–∫–æ–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h3>
                <div id="highPaidVacancies"></div>
            </div>
        </div>

        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ -->
        <div class="implementation-switcher">
            <label>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:</label>
            <select id="implementationType">
                <option value="class">–ö–ª–∞—Å—Å—ã (ES6)</option>
                <option value="prototype">–ü—Ä–æ—Ç–æ—Ç–∏–ø—ã</option>
            </select>
            <button onclick="switchImplementation()" class="btn-switch">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å</button>
            <button onclick="exportToJSON()" class="btn-export">–≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
        </div>
    </div>

    {% if vacancies %}
    <div class="vacancies-list clearfix">
        {% for vacancy in vacancies %}
        <div class="vacancy-card">
            <div class="vacancy-header clearfix">
                <h2 class="vacancy-title">{{ vacancy.title }}</h2>
                <span class="vacancy-date">–î–æ–±–∞–≤–ª–µ–Ω–æ: {{ vacancy.created_date|date:'d.m.Y' }}</span>
            </div>
            
            <div class="vacancy-content">
                <div class="vacancy-text">
                    {{ vacancy.description|linebreaks }}
                </div>
            </div>
            
            <div class="vacancy-actions clearfix">
                <button class="btn-apply" onclick="showApplicationForm({{ vacancy.id }})">–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é</button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-vacancies">
        <div class="empty-state">
            <img src="{% static 'delivery_app/images/empty-vacancies.svg' %}" alt="–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π" class="empty-image">
            <h3>–°–µ–π—á–∞—Å –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π</h3>
            <p>–ù–æ –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–º —Å–≤–æ—ë —Ä–µ–∑—é–º–µ, –∏ –º—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏, –∫–æ–≥–¥–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ö–æ–¥—è—â–∞—è –≤–∞–∫–∞–Ω—Å–∏—è.</p>
            <button class="btn-send-resume">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—é–º–µ</button>
        </div>
    </div>
    {% endif %}

    <div class="benefits-section clearfix">
        <h2>–ü–æ—á–µ–º—É —Å—Ç–æ–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —É –Ω–∞—Å?</h2>
        <div class="benefits-container">
            <div class="benefit-item">
                <div class="benefit-icon">üíº</div>
                <h3>–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å</h3>
                <p>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞ –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üìà</div>
                <h3>–†–∞–∑–≤–∏—Ç–∏–µ</h3>
                <p>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">ü§ù</div>
                <h3>–ö–æ–º–∞–Ω–¥–∞</h3>
                <p>–î—Ä—É–∂–Ω—ã–π –∫–æ–ª–ª–µ–∫—Ç–∏–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø—ã—Ç–Ω—ã—Ö –∫–æ–ª–ª–µ–≥</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üçé</div>
                <h3>–õ—å–≥–æ—Ç—ã</h3>
                <p>–°–∫–∏–¥–∫–∏ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã, –±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</p>
            </div>
        </div>
    </div>
</div>

<style>
/* Clearfix –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ float */
.clearfix::after {
    content: "";
    display: table;
    clear: both;
}

.vacancies-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
}

.page-header {
    text-align: center;
    margin-bottom: 40px;
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 10px;
}

.page-header h1 {
    color: #2c5aa0;
    margin-bottom: 10px;
    font-size: 2.2em;
}

.page-subtitle {
    font-size: 1.2em;
    color: #6c757d;
    margin-bottom: 15px;
    line-height: 1.4;
}

.current-date {
    font-size: 0.9em;
    color: #6c757d;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π —Å float */
.vacancies-list {
    margin-bottom: 50px;
}

.vacancy-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 25px;
    margin-bottom: 25px;
    border-left: 4px solid #2c5aa0;
    float: left;
    width: 100%;
    box-sizing: border-box;
}

.vacancy-card:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
    transition: all 0.3s ease;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–∏ —Å float */
.vacancy-header {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
}

.vacancy-title {
    color: #2c5aa0;
    margin: 0;
    float: left;
    font-size: 1.4em;
    line-height: 1.3;
}

.vacancy-date {
    color: #6c757d;
    font-size: 0.9em;
    float: right;
    background: #f8f9fa;
    padding: 4px 8px;
    border-radius: 4px;
}

/* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ */
.vacancy-content {
    line-height: 1.7;
    margin-bottom: 20px;
    color: #495057;
}

.vacancy-text {
    text-align: justify;
}

.vacancy-text h3,
.vacancy-text h4 {
    color: #2c5aa0;
    margin: 20px 0 10px 0;
    font-size: 1.1em;
}

.vacancy-text ul,
.vacancy-text ol {
    margin: 10px 0;
    padding-left: 25px;
}

.vacancy-text li {
    margin-bottom: 8px;
    line-height: 1.6;
}

.vacancy-text p {
    margin-bottom: 15px;
    line-height: 1.7;
}

.vacancy-text strong {
    color: #2c5aa0;
    font-weight: 600;
}

/* –ö–Ω–æ–ø–∫–∏ —Å float */
.vacancy-actions {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #e9ecef;
}

.btn-apply {
    background-color: #2c5aa0;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    float: right;
    transition: background-color 0.3s ease;
    font-size: 0.95em;
}

.btn-apply:hover {
    background-color: #1e3d6f;
    transform: translateY(-1px);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ benefits —Å float */
.benefits-section {
    background-color: #f8f9fa;
    padding: 40px;
    border-radius: 10px;
    margin-top: 30px;
}

.benefits-section h2 {
    text-align: center;
    color: #2c5aa0;
    margin-bottom: 30px;
    font-size: 1.8em;
}

.benefits-container {
    margin: 0 -15px;
}

.benefit-item {
    float: left;
    width: 48%;
    margin: 0 1% 25px 1%;
    text-align: center;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    box-sizing: border-box;
    min-height: 200px;
}

.benefit-icon {
    font-size: 2.5em;
    margin-bottom: 15px;
}

.benefit-item h3 {
    color: #2c5aa0;
    margin-bottom: 10px;
    font-size: 1.2em;
}

.benefit-item p {
    color: #6c757d;
    line-height: 1.5;
    font-size: 0.95em;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø—É—Å—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
.no-vacancies {
    text-align: center;
    padding: 40px 0;
}

.empty-state {
    max-width: 500px;
    margin: 0 auto;
}

.empty-image {
    max-width: 200px;
    margin-bottom: 20px;
}

.btn-send-resume {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 15px;
    transition: background-color 0.3s ease;
}

.btn-send-resume:hover {
    background-color: #218838;
}

.demo-section {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
    border-left: 4px solid #2c5aa0;
}

.form-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #2c5aa0;
}

.form-group input, .form-group select {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
    box-sizing: border-box;
}

.phone-format {
    display: block;
    color: #6c757d;
    font-size: 0.8em;
    margin-top: 4px;
}

.btn-add, .btn-switch, .btn-clear, .btn-export, .btn-sort {
    background-color: #2c5aa0;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-right: 10px;
    margin-bottom: 10px;
    font-size: 0.9em;
}

.btn-clear {
    background-color: #dc3545;
}

.btn-export {
    background-color: #28a745;
}

.btn-sort {
    background-color: #6c757d;
    padding: 6px 12px;
    font-size: 0.8em;
}

.btn-add:hover, .btn-switch:hover, .btn-sort:hover {
    background-color: #1e3d6f;
}

.btn-clear:hover {
    background-color: #c82333;
}

.btn-export:hover {
    background-color: #218838;
}

.results-section {
    display: flex;
    gap: 20px;
    margin-top: 20px;
}

.results-column {
    flex: 1;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
}

.vacancy-item {
    background: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-left: 3px solid #2c5aa0;
    position: relative;
}

.vacancy-item.high-paid {
    border-left-color: #28a745;
    background: #f8fff9;
}

.vacancy-item .salary {
    font-size: 1.2em;
    font-weight: bold;
    color: #2c5aa0;
}

.vacancy-item .city {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #e9ecef;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
}

.vacancy-item .profession {
    color: #2c5aa0;
    margin-bottom: 8px;
    font-size: 1.1em;
}

.filter-section {
    margin-bottom: 15px;
    padding: 10px;
    background: white;
    border-radius: 5px;
}

.filter-section select {
    margin: 0 10px;
    padding: 5px;
}

.implementation-switcher {
    margin-top: 20px;
    padding: 15px;
    background: #e9ecef;
    border-radius: 8px;
}

.implementation-switcher select {
    padding: 5px 10px;
    margin: 0 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.stats {
    background: white;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
    font-size: 0.9em;
}

@media (max-width: 768px) {
    .results-section {
        flex-direction: column;
    }
    
    .btn-add, .btn-switch, .btn-clear, .btn-export {
        width: 100%;
        margin-right: 0;
    }
}
/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .vacancy-title {
        float: none;
        margin-bottom: 10px;
    }
    
    .vacancy-date {
        float: none;
        display: inline-block;
    }
    
    .benefit-item {
        float: none;
        width: 100%;
        margin: 0 0 20px 0;
        min-height: auto;
    }
    
    .btn-apply {
        float: none;
        width: 100%;
    }
    
    .vacancies-container {
        padding: 15px;
    }
    
    .benefits-section {
        padding: 25px;
    }
    
    .page-header h1 {
        font-size: 1.8em;
    }
}

@media (min-width: 769px) and (max-width: 1024px) {
    .benefit-item {
        width: 48%;
        margin: 0 1% 20px 1%;
    }
}
</style>

<script>
// ====== –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Å –ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω—ã–º –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º ======

// –ë–∞–∑–æ–≤—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä Vacancy
function Vacancy(profession, salary, phone, city) {
    this._profession = profession;
    this._salary = salary;
    this._phone = phone;
    this._city = city;
    this._id = Date.now() + Math.random();
    this._createdDate = new Date().toLocaleDateString('ru-BY');
}

// –ú–µ—Ç–æ–¥—ã –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞
Vacancy.prototype = {
    // –ì–µ—Ç—Ç–µ—Ä—ã
    getProfession: function() { return this._profession; },
    getSalary: function() { return this._salary; },
    getPhone: function() { return this._phone; },
    getCity: function() { return this._city; },
    getId: function() { return this._id; },
    getCreatedDate: function() { return this._createdDate; },
    
    // –°–µ—Ç—Ç–µ—Ä—ã
    setProfession: function(value) { this._profession = value; },
    setSalary: function(value) { this._salary = value; },
    setPhone: function(value) { this._phone = value; },
    setCity: function(value) { this._city = value; },
    
    // –ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏
    display: function() {
        return `
            <div class="vacancy-item" data-id="${this._id}">
                <div class="city">${this._city}</div>
                <div class="profession">${this._profession}</div>
                <p><strong>–ó–∞—Ä–ø–ª–∞—Ç–∞:</strong> <span class="salary">${this._salary} BYN</span></p>
                <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${this.formatPhone(this._phone)}</p>
                <p><strong>–î–æ–±–∞–≤–ª–µ–Ω–æ:</strong> ${this._createdDate}</p>
                <button onclick="deleteVacancy('${this._id}')" class="btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        `;
    },
    
    formatPhone: function(phone) {
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞
        return phone.replace(/(\+375)(\d{2})(\d{3})(\d{2})(\d{2})/, '$1 ($2) $3-$4-$5');
    }
};

// –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä ExtendedVacancy (–Ω–∞—Å–ª–µ–¥–Ω–∏–∫)
function ExtendedVacancy(profession, salary, phone, city, email, experience) {
    Vacancy.call(this, profession, salary, phone, city);
    this._email = email || '–ù–µ —É–∫–∞–∑–∞–Ω';
    this._experience = experience || '–ù–µ —É–∫–∞–∑–∞–Ω';
}

// –ü—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
ExtendedVacancy.prototype = Object.create(Vacancy.prototype);
ExtendedVacancy.prototype.constructor = ExtendedVacancy;

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
ExtendedVacancy.prototype.getEmail = function() { return this._email; };
ExtendedVacancy.prototype.getExperience = function() { return this._experience; };
ExtendedVacancy.prototype.setEmail = function(value) { this._email = value; };
ExtendedVacancy.prototype.setExperience = function(value) { this._experience = value; };

// –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ display
ExtendedVacancy.prototype.display = function() {
    return `
        <div class="vacancy-item" data-id="${this._id}">
            <div class="city">${this._city}</div>
            <div class="profession">${this._profession}</div>
            <p><strong>–ó–∞—Ä–ø–ª–∞—Ç–∞:</strong> <span class="salary">${this._salary} BYN</span></p>
            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${this.formatPhone(this._phone)}</p>
            <p><strong>Email:</strong> ${this._email}</p>
            <p><strong>–û–ø—ã—Ç:</strong> ${this._experience}</p>
            <p><strong>–î–æ–±–∞–≤–ª–µ–Ω–æ:</strong> ${this._createdDate}</p>
            <button onclick="deleteVacancy('${this._id}')" class="btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
    `;
};

// –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–∞–∫–∞–Ω—Å–∏–π –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–π –≤–µ—Ä—Å–∏–∏
const PrototypeVacancyManager = {
    vacancies: [],
    
    addVacancy: function(formData) {
        const profession = formData.get('profession');
        const salary = parseInt(formData.get('salary'));
        const phone = formData.get('phone');
        const city = formData.get('city');
        const email = formData.get('email');
        const experience = formData.get('experience');
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞
        if (!this.validateBelarusPhone(phone)) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: +375XXXXXXXXX');
            return;
        }
        
        let vacancy;
        if (email || experience) {
            vacancy = new ExtendedVacancy(profession, salary, phone, city, email, experience);
        } else {
            vacancy = new Vacancy(profession, salary, phone, city);
        }
        
        this.vacancies.push(vacancy);
        this.saveToLocalStorage();
        this.updateDisplay();
    },
    
    validateBelarusPhone: function(phone) {
        const phoneRegex = /^\+375(25|29|33|44)\d{7}$/;
        return phoneRegex.test(phone.replace(/\s|\(|\)|-/g, ''));
    },
    
    displayAllVacancies: function() {
        if (this.vacancies.length === 0) {
            return '<p>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π</p>';
        }
        return this.vacancies.map(v => v.display()).join('');
    },
    
    getHighPaidVacancies: function() {
        const professions = [...new Set(this.vacancies.map(v => v.getProfession()))];
        let result = '';
        
        professions.forEach(profession => {
            const professionVacancies = this.vacancies.filter(v => v.getProfession() === profession);
            if (professionVacancies.length > 1) {
                const avgSalary = professionVacancies.reduce((sum, v) => sum + v.getSalary(), 0) / professionVacancies.length;
                const highPaid = professionVacancies.filter(v => v.getSalary() > avgSalary);
                
                if (highPaid.length > 0) {
                    result += `<div class="stats">–ü—Ä–æ—Ñ–µ—Å—Å–∏—è: <strong>${profession}</strong> | –°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞: <strong>${avgSalary.toFixed(0)} BYN</strong></div>`;
                    result += highPaid.map(v => {
                        const display = v.display();
                        return display.replace('vacancy-item', 'vacancy-item high-paid');
                    }).join('');
                }
            }
        });
        
        return result || '<p>–ù–µ—Ç –≤—ã—Å–æ–∫–æ–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π</p>';
    },
    
    updateDisplay: function() {
        document.getElementById('allVacancies').innerHTML = this.displayAllVacancies();
        document.getElementById('highPaidVacancies').innerHTML = this.getHighPaidVacancies();
        document.getElementById('vacanciesCount').textContent = `(${this.vacancies.length})`;
    },
    
    saveToLocalStorage: function() {
        const data = this.vacancies.map(v => ({
            type: v instanceof ExtendedVacancy ? 'extended' : 'base',
            profession: v.getProfession(),
            salary: v.getSalary(),
            phone: v.getPhone(),
            city: v.getCity(),
            email: v.getEmail ? v.getEmail() : null,
            experience: v.getExperience ? v.getExperience() : null,
            id: v.getId(),
            createdDate: v.getCreatedDate()
        }));
        localStorage.setItem('Vacancies', JSON.stringify(data));
    },
    
    loadFromLocalStorage: function() {
        const data = localStorage.getItem('Vacancies');
        if (data) {
            const parsedData = JSON.parse(data);
            this.vacancies = parsedData.map(item => {
                if (item.type === 'extended') {
                    return new ExtendedVacancy(item.profession, item.salary, item.phone, item.city, item.email, item.experience);
                } else {
                    return new Vacancy(item.profession, item.salary, item.phone, item.city);
                }
            });
            this.updateDisplay();
        }
    },
    
    deleteVacancy: function(id) {
        this.vacancies = this.vacancies.filter(v => v.getId() !== id);
        this.saveToLocalStorage();
        this.updateDisplay();
    },
    
    clearAllVacancies: function() {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏?')) {
            this.vacancies = [];
            this.saveToLocalStorage();
            this.updateDisplay();
        }
    },
    
    filterByCity: function(city) {
        const filtered = city ? this.vacancies.filter(v => v.getCity() === city) : this.vacancies;
        document.getElementById('allVacancies').innerHTML = filtered.map(v => v.display()).join('') || '<p>–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ</p>';
    },
    
    sortBySalary: function() {
        this.vacancies.sort((a, b) => b.getSalary() - a.getSalary());
        this.updateDisplay();
    }
};

// ====== –ö–ª–∞—Å—Å—ã ES6 ======

class VacancyBase {
    constructor(profession, salary, phone, city) {
        this._profession = profession;
        this._salary = salary;
        this._phone = phone;
        this._city = city;
        this._id = Date.now() + Math.random();
        this._createdDate = new Date().toLocaleDateString('ru-BY');
    }
    
    // –ì–µ—Ç—Ç–µ—Ä—ã
    get profession() { return this._profession; }
    get salary() { return this._salary; }
    get phone() { return this._phone; }
    get city() { return this._city; }
    get id() { return this._id; }
    get createdDate() { return this._createdDate; }
    
    // –°–µ—Ç—Ç–µ—Ä—ã
    set profession(value) { this._profession = value; }
    set salary(value) { this._salary = value; }
    set phone(value) { this._phone = value; }
    set city(value) { this._city = value; }
    
    // –ú–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    display() {
        return `
            <div class="vacancy-item" data-id="${this._id}">
                <div class="city">${this._city}</div>
                <div class="profession">${this._profession}</div>
                <p><strong>–ó–∞—Ä–ø–ª–∞—Ç–∞:</strong> <span class="salary">${this._salary} BYN</span></p>
                <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${this.formatPhone(this._phone)}</p>
                <p><strong>–î–æ–±–∞–≤–ª–µ–Ω–æ:</strong> ${this._createdDate}</p>
                <button onclick="deleteVacancy('${this._id}')" class="btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        `;
    }
    
    formatPhone(phone) {
        return phone.replace(/(\+375)(\d{2})(\d{3})(\d{2})(\d{2})/, '$1 ($2) $3-$4-$5');
    }
}

class ExtendedVacancyClass extends VacancyBase {
    constructor(profession, salary, phone, city, email, experience) {
        super(profession, salary, phone, city);
        this._email = email || '–ù–µ —É–∫–∞–∑–∞–Ω';
        this._experience = experience || '–ù–µ —É–∫–∞–∑–∞–Ω';
    }
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥–µ—Ç—Ç–µ—Ä—ã –∏ —Å–µ—Ç—Ç–µ—Ä—ã
    get email() { return this._email; }
    get experience() { return this._experience; }
    set email(value) { this._email = value; }
    set experience(value) { this._experience = value; }
    
    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ display
    display() {
        return `
            <div class="vacancy-item" data-id="${this._id}">
                <div class="city">${this._city}</div>
                <div class="profession">${this._profession}</div>
                <p><strong>–ó–∞—Ä–ø–ª–∞—Ç–∞:</strong> <span class="salary">${this._salary} BYN</span></p>
                <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${this.formatPhone(this._phone)}</p>
                <p><strong>Email:</strong> ${this._email}</p>
                <p><strong>–û–ø—ã—Ç:</strong> ${this._experience}</p>
                <p><strong>–î–æ–±–∞–≤–ª–µ–Ω–æ:</strong> ${this._createdDate}</p>
                <button onclick="deleteVacancy('${this._id}')" class="btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        `;
    }
}

class ClassVacancyManager {
    constructor() {
        this.vacancies = [];
        this.loadFromLocalStorage();
    }
    
    addVacancy(formData) {
        const profession = formData.get('profession');
        const salary = parseInt(formData.get('salary'));
        const phone = formData.get('phone');
        const city = formData.get('city');
        const email = formData.get('email');
        const experience = formData.get('experience');
        
        if (!this.validateBelarusPhone(phone)) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: +375XXXXXXXXX');
            return;
        }
        
        let vacancy;
        if (email || experience) {
            vacancy = new ExtendedVacancyClass(profession, salary, phone, city, email, experience);
        } else {
            vacancy = new VacancyBase(profession, salary, phone, city);
        }
        
        this.vacancies.push(vacancy);
        this.saveToLocalStorage();
        this.updateDisplay();
    }
    
    validateBelarusPhone(phone) {
        const phoneRegex = /^\+375(25|29|33|44)\d{7}$/;
        return phoneRegex.test(phone.replace(/\s|\(|\)|-/g, ''));
    }
    
    displayAllVacancies() {
        if (this.vacancies.length === 0) {
            return '<p>–ù–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π</p>';
        }
        return this.vacancies.map(v => v.display()).join('');
    }
    
    getHighPaidVacancies() {
        const professions = [...new Set(this.vacancies.map(v => v.profession))];
        let result = '';
        
        professions.forEach(profession => {
            const professionVacancies = this.vacancies.filter(v => v.profession === profession);
            if (professionVacancies.length > 1) {
                const avgSalary = professionVacancies.reduce((sum, v) => sum + v.salary, 0) / professionVacancies.length;
                const highPaid = professionVacancies.filter(v => v.salary > avgSalary);
                
                if (highPaid.length > 0) {
                    result += `<div class="stats">–ü—Ä–æ—Ñ–µ—Å—Å–∏—è: <strong>${profession}</strong> | –°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞: <strong>${avgSalary.toFixed(0)} BYN</strong></div>`;
                    result += highPaid.map(v => {
                        const display = v.display();
                        return display.replace('vacancy-item', 'vacancy-item high-paid');
                    }).join('');
                }
            }
        });
        
        return result || '<p>–ù–µ—Ç –≤—ã—Å–æ–∫–æ–æ–ø–ª–∞—á–∏–≤–∞–µ–º—ã—Ö –≤–∞–∫–∞–Ω—Å–∏–π</p>';
    }
    
    updateDisplay() {
        document.getElementById('allVacancies').innerHTML = this.displayAllVacancies();
        document.getElementById('highPaidVacancies').innerHTML = this.getHighPaidVacancies();
        document.getElementById('vacanciesCount').textContent = `(${this.vacancies.length})`;
    }
    
    saveToLocalStorage() {
        const data = this.vacancies.map(v => ({
            type: v instanceof ExtendedVacancyClass ? 'extended' : 'base',
            profession: v.profession,
            salary: v.salary,
            phone: v.phone,
            city: v.city,
            email: v.email || null,
            experience: v.experience || null,
            id: v.id,
            createdDate: v.createdDate
        }));
        localStorage.setItem('Vacancies', JSON.stringify(data));
    }
    
    loadFromLocalStorage() {
        const data = localStorage.getItem('Vacancies');
        if (data) {
            const parsedData = JSON.parse(data);
            this.vacancies = parsedData.map(item => {
                if (item.type === 'extended') {
                    return new ExtendedVacancyClass(item.profession, item.salary, item.phone, item.city, item.email, item.experience);
                } else {
                    return new VacancyBase(item.profession, item.salary, item.phone, item.city);
                }
            });
            this.updateDisplay();
        }
    }
    
    deleteVacancy(id) {
        this.vacancies = this.vacancies.filter(v => v.id !== id);
        this.saveToLocalStorage();
        this.updateDisplay();
    }
    
    clearAllVacancies() {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏?')) {
            this.vacancies = [];
            this.saveToLocalStorage();
            this.updateDisplay();
        }
    }
    
    filterByCity(city) {
        const filtered = city ? this.vacancies.filter(v => v.city === city) : this.vacancies;
        document.getElementById('allVacancies').innerHTML = filtered.map(v => v.display()).join('') || '<p>–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –≥–æ—Ä–æ–¥–µ</p>';
    }
    
    sortBySalary() {
        this.vacancies.sort((a, b) => b.salary - a.salary);
        this.updateDisplay();
    }
}

// ====== –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø–ú–ò ======

let currentManager = new ClassVacancyManager();

function switchImplementation() {
    const type = document.getElementById('implementationType').value;
    
    if (type === 'class') {
        currentManager = new ClassVacancyManager();
    } else {
        currentManager = Object.create(PrototypeVacancyManager);
        currentManager.vacancies = [];
        currentManager.loadFromLocalStorage();
    }
    
    addDemoData();
    alert(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ ${type === 'class' ? '–∫–ª–∞—Å—Å—ã ES6' : '–ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ'}`);
}

function deleteVacancy(id) {
    currentManager.deleteVacancy(id);
}

function clearAllVacancies() {
    currentManager.clearAllVacancies();
}

function filterByCity() {
    const city = document.getElementById('cityFilter').value;
    currentManager.filterByCity(city);
}

function sortBySalary() {
    currentManager.sortBySalary();
}

function exportToJSON() {
    const data = currentManager.vacancies.map(v => ({
        profession: v.profession || v.getProfession(),
        salary: v.salary || v.getSalary(),
        phone: v.phone || v.getPhone(),
        city: v.city || v.getCity(),
        email: v.email || (v.getEmail ? v.getEmail() : '–ù–µ —É–∫–∞–∑–∞–Ω'),
        experience: v.experience || (v.getExperience ? v.getExperience() : '–ù–µ —É–∫–∞–∑–∞–Ω'),
        createdDate: v.createdDate || v.getCreatedDate()
    }));
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'vacancies.json';
    a.click();
    URL.revokeObjectURL(url);
}

function addDemoData() {
    if (currentManager.vacancies.length === 0) {
        const demoData = [
            ['–í–æ–¥–∏—Ç–µ–ª—å-–∫—É—Ä—å–µ—Ä', 1500, '+375291234567', '–ú–∏–Ω—Å–∫', 'hr@delivery.by', '1-3 –≥–æ–¥–∞'],
            ['–í–æ–¥–∏—Ç–µ–ª—å-–∫—É—Ä—å–µ—Ä', 1800, '+375331234568', '–ì—Ä–æ–¥–Ω–æ'],
            ['–ö—É—Ä—å–µ—Ä', 1200, '+375441234569', '–ú–∏–Ω—Å–∫', '', '–ë–µ–∑ –æ–ø—ã—Ç–∞'],
            ['–ö—É—Ä—å–µ—Ä', 1400, '+375251234570', '–ë—Ä–µ—Å—Ç', 'recruitment@company.by', '1-3 –≥–æ–¥–∞'],
            ['–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ª–æ–≥–∏—Å—Ç–∏–∫–µ', 2000, '+375291234571', '–ú–∏–Ω—Å–∫', 'logistics@delivery.by', '3-5 –ª–µ—Ç'],
            ['–í–æ–¥–∏—Ç–µ–ª—å-–∫—É—Ä—å–µ—Ä', 1600, '+375331234572', '–í–∏—Ç–µ–±—Å–∫']
        ];
        
        demoData.forEach(data => {
            const formData = new FormData();
            formData.append('profession', data[0]);
            formData.append('salary', data[1]);
            formData.append('phone', data[2]);
            formData.append('city', data[3]);
            if (data[4]) formData.append('email', data[4]);
            if (data[5]) formData.append('experience', data[5]);
            
            currentManager.addVacancy(formData);
        });
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('vacancyForm');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(form);
        currentManager.addVacancy(formData);
        form.reset();
    });
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    if (currentManager.vacancies.length === 0) {
        addDemoData();
    }
});


function showApplicationForm(vacancyId) {
    alert('–§–æ—Ä–º–∞ –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é #' + vacancyId + ' –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');
}
</script>
{% endblock %}